<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm BN: ranged Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm BN
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('namespaceranged.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ranged Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a5d9da06327706ab87ae19ee9dc08de53"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">hit_tier</a> : int { <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">grazing</a> = 0
, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555">normal</a>
, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">critical</a>
 }</td></tr>
<tr class="separator:a5d9da06327706ab87ae19ee9dc08de53"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7a391700b761ffa6bc80dc0a998267cb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a7a391700b761ffa6bc80dc0a998267cb">draw_cone_aoe</a> (const <a class="el" href="structtripoint.html">tripoint</a> &amp;origin, const std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt; &amp;aoe)</td></tr>
<tr class="separator:a7a391700b761ffa6bc80dc0a998267cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0ad7f6e4c593e68012655f0befed8cf"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ad0ad7f6e4c593e68012655f0befed8cf">hit_chance</a> (const <a class="el" href="classdispersion__sources.html">dispersion_sources</a> &amp;dispersion, double range, double target_size, double missed_by=1.0)</td></tr>
<tr class="memdesc:ad0ad7f6e4c593e68012655f0befed8cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">The chance that a fired shot reaches required accuracy - by default grazing shot.  <a href="namespaceranged.html#ad0ad7f6e4c593e68012655f0befed8cf">More...</a><br /></td></tr>
<tr class="separator:ad0ad7f6e4c593e68012655f0befed8cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af042bc3e3b1ea1c57a42ee323ad284a8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#af042bc3e3b1ea1c57a42ee323ad284a8">print_dmg_msg</a> (<a class="el" href="classCreature.html">Creature</a> &amp;target, <a class="el" href="classCreature.html">Creature</a> *source, const <a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a> &amp;dealt_dam, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">hit_tier</a> ht)</td></tr>
<tr class="separator:af042bc3e3b1ea1c57a42ee323ad284a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51e6279a2008714e5596da4f5fa1b00e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">hit_with_aoe</a> (<a class="el" href="classCreature.html">Creature</a> &amp;target, <a class="el" href="classCreature.html">Creature</a> *source, const <a class="el" href="structdamage__instance.html">damage_instance</a> &amp;di)</td></tr>
<tr class="separator:a51e6279a2008714e5596da4f5fa1b00e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a581c5c797384eeec8c7e3ffe10a82d26"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a581c5c797384eeec8c7e3ffe10a82d26">throw_cost</a> (const <a class="el" href="classplayer.html">player</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const <a class="el" href="classitem.html">item</a> &amp;to_throw)</td></tr>
<tr class="separator:a581c5c797384eeec8c7e3ffe10a82d26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8c85e0249f67213d9994612315aa3e"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">get_str_draw_penalty</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="memdesc:a4c8c85e0249f67213d9994612315aa3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Penalties potentially incurred by STR_DRAW weapons.  <a href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">More...</a><br /></td></tr>
<tr class="separator:a4c8c85e0249f67213d9994612315aa3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32d7ead84f4eb01b4050fdbbca0767ea"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a32d7ead84f4eb01b4050fdbbca0767ea">str_draw_damage_modifier</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="separator:a32d7ead84f4eb01b4050fdbbca0767ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a613a2847b3c06998d6117f2630fc9ed5"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a613a2847b3c06998d6117f2630fc9ed5">str_draw_dispersion_modifier</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="separator:a613a2847b3c06998d6117f2630fc9ed5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7a46e309ff8892e692a92511635a4eb"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aa7a46e309ff8892e692a92511635a4eb">str_draw_range_modifier</a> (const <a class="el" href="classitem.html">item</a> &amp;it, const <a class="el" href="classCharacter.html">Character</a> &amp;p)</td></tr>
<tr class="separator:aa7a46e309ff8892e692a92511635a4eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd6b1338d47e5ecd34de75b921c11113"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">throw_dispersion_per_dodge</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, bool add_encumbrance)</td></tr>
<tr class="memdesc:afd6b1338d47e5ecd34de75b921c11113"><td class="mdescLeft">&#160;</td><td class="mdescRight">How much dispersion does one point of target's dodge add when throwing at said target?  <a href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">More...</a><br /></td></tr>
<tr class="separator:afd6b1338d47e5ecd34de75b921c11113"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54895869f69a00b4a74df15057a9a780"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">throwing_dispersion</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const <a class="el" href="classitem.html">item</a> &amp;to_throw, <a class="el" href="classCreature.html">Creature</a> *critter, bool is_blind_throw)</td></tr>
<tr class="memdesc:a54895869f69a00b4a74df15057a9a780"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispersion of a thrown item, against a given target, taking into account whether or not the throw was blind.  <a href="namespaceranged.html#a54895869f69a00b4a74df15057a9a780">More...</a><br /></td></tr>
<tr class="separator:a54895869f69a00b4a74df15057a9a780"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fc846128cfc30100d71fbb6e2d482c5"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a3fc846128cfc30100d71fbb6e2d482c5">targetable_creatures</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const int range)</td></tr>
<tr class="separator:a3fc846128cfc30100d71fbb6e2d482c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41e7f0a8b2c552d2f8ec4c8a4930c7af"><td class="memItemLeft" align="right" valign="top">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af">targetable_creatures</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;<a class="el" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, const int range, const <a class="el" href="classturret__data.html">turret_data</a> &amp;turret)</td></tr>
<tr class="separator:a41e7f0a8b2c552d2f8ec4c8a4930c7af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5332ed56c9f0b3702e72aecdcaa1e7be"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a5332ed56c9f0b3702e72aecdcaa1e7be">burst_penalty</a> (const <a class="el" href="classCharacter.html">Character</a> &amp;p, const <a class="el" href="classitem.html">item</a> &amp;gun, int gun_recoil)</td></tr>
<tr class="separator:a5332ed56c9f0b3702e72aecdcaa1e7be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed4420a1fd77e160a72de2a528e56da5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">gunmode_checks_common</a> (<a class="el" href="classavatar.html">avatar</a> &amp;you, const <a class="el" href="classmap.html">map</a> &amp;m, std::vector&lt; std::string &gt; &amp;messages, const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;gmode)</td></tr>
<tr class="memdesc:aed4420a1fd77e160a72de2a528e56da5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Common checks for gunmode (when firing a weapon / manually firing turret)  <a href="namespaceranged.html#aed4420a1fd77e160a72de2a528e56da5">More...</a><br /></td></tr>
<tr class="separator:aed4420a1fd77e160a72de2a528e56da5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a743f9e35b20c136e56ca9e9480fb27bc"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">gunmode_checks_weapon</a> (<a class="el" href="classavatar.html">avatar</a> &amp;you, const <a class="el" href="classmap.html">map</a> &amp;m, std::vector&lt; std::string &gt; &amp;messages, const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;gmode)</td></tr>
<tr class="memdesc:a743f9e35b20c136e56ca9e9480fb27bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Various checks for gunmode when firing a weapon.  <a href="namespaceranged.html#a743f9e35b20c136e56ca9e9480fb27bc">More...</a><br /></td></tr>
<tr class="separator:a743f9e35b20c136e56ca9e9480fb27bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade9b38890f46ab6cbe94e1004f0ea5f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">execute_shaped_attack</a> (const <a class="el" href="classshape.html">shape</a> &amp;sh, const <a class="el" href="structprojectile.html">projectile</a> &amp;proj, <a class="el" href="classCreature.html">Creature</a> &amp;attacker)</td></tr>
<tr class="memdesc:ade9b38890f46ab6cbe94e1004f0ea5f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">AoE attack, with area given by shape.  <a href="namespaceranged.html#ade9b38890f46ab6cbe94e1004f0ea5f1">More...</a><br /></td></tr>
<tr class="separator:ade9b38890f46ab6cbe94e1004f0ea5f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b4da33d1d9391123845f299f1f156dc"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#a7b4da33d1d9391123845f299f1f156dc">expected_coverage</a> (const <a class="el" href="classshape.html">shape</a> &amp;sh, const <a class="el" href="classmap.html">map</a> &amp;here, int bash_power)</td></tr>
<tr class="separator:a7b4da33d1d9391123845f299f1f156dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7778ea8feb8352ac65fe74e81164ebc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc">prompt_select_default_ammo_for</a> (<a class="el" href="classavatar.html">avatar</a> &amp;u, const <a class="el" href="classitem.html">item</a> &amp;w)</td></tr>
<tr class="memdesc:ae7778ea8feb8352ac65fe74e81164ebc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prompts to select default ammo compatible with provided gun.  <a href="namespaceranged.html#ae7778ea8feb8352ac65fe74e81164ebc">More...</a><br /></td></tr>
<tr class="separator:ae7778ea8feb8352ac65fe74e81164ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf8b46e1f1dae2e7a3d4ff75b9495026"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">handle_gun_damage</a> (<a class="el" href="classCharacter.html">Character</a> &amp;shooter, <a class="el" href="classitem.html">item</a> &amp;it)</td></tr>
<tr class="memdesc:abf8b46e1f1dae2e7a3d4ff75b9495026"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if a gun misfires, jams, or has other problems, else returns false.  <a href="namespaceranged.html#abf8b46e1f1dae2e7a3d4ff75b9495026">More...</a><br /></td></tr>
<tr class="separator:abf8b46e1f1dae2e7a3d4ff75b9495026"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a5d9da06327706ab87ae19ee9dc08de53" name="a5d9da06327706ab87ae19ee9dc08de53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d9da06327706ab87ae19ee9dc08de53">&#9670;&nbsp;</a></span>hit_tier</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">ranged::hit_tier</a> : int</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597" name="a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597"></a>grazing&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555" name="a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555"></a>normal&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8" name="a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8"></a>critical&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="ranged_8h_source.html#l00108">108</a> of file <a class="el" href="ranged_8h_source.html">ranged.h</a>.</p>
<div class="fragment"><div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                    : <span class="keywordtype">int</span> {</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <a class="code hl_enumvalue" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">grazing</a> = 0,</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    normal,</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <a class="code hl_enumvalue" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">critical</a></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>};</div>
<div class="ttc" id="anamespaceranged_html_a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597"><div class="ttname"><a href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">ranged::hit_tier::grazing</a></div><div class="ttdeci">@ grazing</div></div>
<div class="ttc" id="anamespaceranged_html_a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8"><div class="ttname"><a href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">ranged::hit_tier::critical</a></div><div class="ttdeci">@ critical</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5332ed56c9f0b3702e72aecdcaa1e7be" name="a5332ed56c9f0b3702e72aecdcaa1e7be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5332ed56c9f0b3702e72aecdcaa1e7be">&#9670;&nbsp;</a></span>burst_penalty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::burst_penalty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>gun</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gun_recoil</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
Dexterity reduces burst penalty by flat amount Strength reduces burst fire penalty Pistol reduces burst fire penalty Smg reduces burst fire penalty Rifle reduces burst fire penalty Shotgun reduces burst fire penalty 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02132">2132</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>{<span class="comment"></span></div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span><span class="comment">    ///\EFFECT_DEX reduces burst penalty by flat amount</span></div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span><span class="comment"></span>    <span class="keywordtype">int</span> dex_effect = p.<a class="code hl_function" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() * 10;<span class="comment"></span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span><span class="comment">    ///\EFFECT_STR reduces burst fire penalty</span></div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span><span class="comment"></span>    <span class="keywordtype">float</span> str_effect = p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() * 0.5f;</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span><span class="comment"></span> </div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span><span class="comment">    /** @EFFECT_PISTOL reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span><span class="comment">    /** @EFFECT_SMG reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span><span class="comment">    /** @EFFECT_RIFLE reduces burst fire penalty */</span><span class="comment"></span></div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span><span class="comment">    /** @EFFECT_SHOTGUN reduces burst fire penalty */</span></div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>    <span class="keywordtype">int</span> skill_lvl = std::min( p.<a class="code hl_function" href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">get_skill_level</a>( gun.<a class="code hl_function" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() ), <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span> </div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>    <span class="keywordflow">return</span> std::max&lt;int&gt;( 0, 3 * ( gun_recoil - dex_effect ) / std::max( 1.0f,</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>                          str_effect + skill_lvl ) );</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>}</div>
<div class="ttc" id="aclassCharacter_html_a34a927d0f161ac92ab0d462397828bd5"><div class="ttname"><a href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">Character::get_dex</a></div><div class="ttdeci">virtual int get_dex() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04068">character.cpp:4068</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5aba683ccf77cb560a0a932308289bd9"><div class="ttname"><a href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">Character::get_str</a></div><div class="ttdeci">virtual int get_str() const</div><div class="ttdoc">Getters for stats exclusive to characters.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04064">character.cpp:4064</a></div></div>
<div class="ttc" id="aclassCharacter_html_afa95fe499ca6b55ab97f1b442a4c95c5"><div class="ttname"><a href="classCharacter.html#afa95fe499ca6b55ab97f1b442a4c95c5">Character::get_skill_level</a></div><div class="ttdeci">int get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03356">character.cpp:3356</a></div></div>
<div class="ttc" id="aclassitem_html_a3d8542661f2e2a82e8cb3792584912f3"><div class="ttname"><a href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">item::gun_skill</a></div><div class="ttdeci">skill_id gun_skill() const</div><div class="ttdoc">The skill used to operate the gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07047">item.cpp:7047</a></div></div>
<div class="ttc" id="agame__constants_8h_html_ae9c0ec5b4724c15132efddb8862ca652"><div class="ttname"><a href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a></div><div class="ttdeci">static constexpr int MAX_SKILL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00111">game_constants.h:111</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="character_8cpp_source.html#l04068">Character::get_dex()</a>, <a class="el" href="character_8cpp_source.html#l03356">Character::get_skill_level()</a>, <a class="el" href="character_8cpp_source.html#l04064">Character::get_str()</a>, <a class="el" href="item_8cpp_source.html#l07047">item::gun_skill()</a>, and <a class="el" href="game__constants_8h_source.html#l00111">MAX_SKILL</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00793">calculate_dispersion()</a>, and <a class="el" href="item_8cpp_source.html#l01976">item::gun_info()</a>.</p>

</div>
</div>
<a id="a7a391700b761ffa6bc80dc0a998267cb" name="a7a391700b761ffa6bc80dc0a998267cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a391700b761ffa6bc80dc0a998267cb">&#9670;&nbsp;</a></span>draw_cone_aoe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::draw_cone_aoe </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structtripoint.html">tripoint</a> &amp;&#160;</td>
          <td class="paramname"><em>origin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt; &amp;&#160;</td>
          <td class="paramname"><em>aoe</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="animation_8cpp_source.html#l01076">1076</a> of file <a class="el" href="animation_8cpp_source.html">animation.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>{</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>    <span class="keywordflow">if</span>( <a class="code hl_variable" href="cached__options_8cpp.html#a07c66893ce868671f9998dad80094cb1">test_mode</a> ) {</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>    }</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span> </div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>    <a class="code hl_typedef" href="animation_8h.html#adc417821aec24e4672777ee602619cc2">bucketed_points</a> buckets = <a class="code hl_function" href="animation_8cpp.html#a8fc0a82b99c5c13bd3e7c63b3d47c3bf">bucket_by_distance</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, aoe );</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>    <span class="comment">// That hardcoded value could be improved... Not sure about the name</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <span class="keywordtype">size_t</span> max_bucket_count = std::min&lt;size_t&gt;( 10, aoe.size() );</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <a class="code hl_typedef" href="animation_8h.html#adc417821aec24e4672777ee602619cc2">bucketed_points</a> waves = <a class="code hl_function" href="animation_8cpp.html#a4136770e1e34083dc24be6a34ec18c1d">optimal_bucketing</a>( buckets, max_bucket_count );</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span> </div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span><span class="preprocessor">#if defined(TILES)</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>    <span class="keywordflow">if</span>( !<a class="code hl_variable" href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a> ) {</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <a class="code hl_function" href="animation_8cpp.html#a1b18612f445cf54b13f5a37623f7d355">draw_cone_aoe_curses</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, waves );</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>    }</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    <span class="comment">// This is copied from explosion code</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    <span class="comment">// Not sure if it couldn&#39;t be cleaner, without that lambda capture thing</span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    <a class="code hl_typedef" href="animation_8h.html#acb5b22df5818d9604feb0abd2f3c06b5">one_bucket</a> combined_layer;</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>    combined_layer.reserve( aoe.size() );</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span> </div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    wave_animation anim;</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span> </div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <a class="code hl_typedef" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;game::draw_callback_t&gt;</a> wave_cb =</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>    make_shared_fast&lt;game::draw_callback_t&gt;( [&amp;]() {</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>        tilecontext-&gt;init_draw_cone_aoe( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, combined_layer );</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>    } );</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;add_draw_callback( wave_cb );</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span> </div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_typedef" href="animation_8h.html#acb5b22df5818d9604feb0abd2f3c06b5">one_bucket</a> &amp;layer : waves ) {</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        <span class="comment">// Older layers get a fade effect</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>        <span class="keywordflow">for</span>( <a class="code hl_struct" href="structpoint__with__value.html">point_with_value</a> &amp;pv : combined_layer ) {</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>            pv.val *= 1.0 - ( 2.0 / max_bucket_count );</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>        }</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        combined_layer.insert( combined_layer.end(), layer.begin(), layer.end() );</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <span class="keywordflow">if</span>( std::any_of( combined_layer.begin(), combined_layer.end(),</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>        []( <span class="keyword">const</span> <a class="code hl_struct" href="structpoint__with__value.html">point_with_value</a> &amp; element ) {</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>        return is_point_visible( element.pt );</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        } ) ) {</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>            anim.progress();</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>        }</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>    }</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span> </div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>    tilecontext-&gt;void_cone_aoe();</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <a class="code hl_function" href="animation_8cpp.html#a1b18612f445cf54b13f5a37623f7d355">draw_cone_aoe_curses</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, waves );</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>}</div>
<div class="ttc" id="aanimation_8cpp_html_a1b18612f445cf54b13f5a37623f7d355"><div class="ttname"><a href="animation_8cpp.html#a1b18612f445cf54b13f5a37623f7d355">draw_cone_aoe_curses</a></div><div class="ttdeci">static void draw_cone_aoe_curses(const tripoint &amp;, const bucketed_points &amp;waves)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01027">animation.cpp:1027</a></div></div>
<div class="ttc" id="aanimation_8cpp_html_a4136770e1e34083dc24be6a34ec18c1d"><div class="ttname"><a href="animation_8cpp.html#a4136770e1e34083dc24be6a34ec18c1d">optimal_bucketing</a></div><div class="ttdeci">bucketed_points optimal_bucketing(const bucketed_points &amp;buckets, size_t max_buckets)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l00990">animation.cpp:990</a></div></div>
<div class="ttc" id="aanimation_8cpp_html_a8fc0a82b99c5c13bd3e7c63b3d47c3bf"><div class="ttname"><a href="animation_8cpp.html#a8fc0a82b99c5c13bd3e7c63b3d47c3bf">bucket_by_distance</a></div><div class="ttdeci">bucketed_points bucket_by_distance(const tripoint &amp;origin, const std::map&lt; tripoint, double &gt; &amp;to_bucket)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l00975">animation.cpp:975</a></div></div>
<div class="ttc" id="aanimation_8h_html_acb5b22df5818d9604feb0abd2f3c06b5"><div class="ttname"><a href="animation_8h.html#acb5b22df5818d9604feb0abd2f3c06b5">one_bucket</a></div><div class="ttdeci">std::vector&lt; point_with_value &gt; one_bucket</div><div class="ttdef"><b>Definition:</b> <a href="animation_8h_source.html#l00049">animation.h:49</a></div></div>
<div class="ttc" id="aanimation_8h_html_adc417821aec24e4672777ee602619cc2"><div class="ttname"><a href="animation_8h.html#adc417821aec24e4672777ee602619cc2">bucketed_points</a></div><div class="ttdeci">std::list&lt; one_bucket &gt; bucketed_points</div><div class="ttdef"><b>Definition:</b> <a href="animation_8h_source.html#l00050">animation.h:50</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a07c66893ce868671f9998dad80094cb1"><div class="ttname"><a href="cached__options_8cpp.html#a07c66893ce868671f9998dad80094cb1">test_mode</a></div><div class="ttdeci">bool test_mode</div><div class="ttdoc">Set to true when running in test mode (e.g.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00003">cached_options.cpp:3</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a9b72c9314ac0439a25820b3abf2229f3"><div class="ttname"><a href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a></div><div class="ttdeci">bool use_tiles</div><div class="ttdoc">Use tiles for display.</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00007">cached_options.cpp:7</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00272">game.cpp:272</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ada897699f31fc8b37c5af09d95d45840"><div class="ttname"><a href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast</a></div><div class="ttdeci">std::shared_ptr&lt; T &gt; shared_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00016">memory_fast.h:16</a></div></div>
<div class="ttc" id="anamespacecoords_html_ad99808a305ad40299e592d1266bed4a7"><div class="ttname"><a href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">coords::origin</a></div><div class="ttdeci">origin</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00057">coordinates.h:57</a></div></div>
<div class="ttc" id="astructpoint__with__value_html"><div class="ttname"><a href="structpoint__with__value.html">point_with_value</a></div><div class="ttdef"><b>Definition:</b> <a href="animation_8h_source.html#l00039">animation.h:39</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="animation_8cpp_source.html#l00975">bucket_by_distance()</a>, <a class="el" href="animation_8cpp_source.html#l01027">draw_cone_aoe_curses()</a>, <a class="el" href="game_8cpp_source.html#l00272">g</a>, <a class="el" href="animation_8cpp_source.html#l00990">optimal_bucketing()</a>, <a class="el" href="cached__options_8cpp_source.html#l00003">test_mode</a>, and <a class="el" href="cached__options_8cpp_source.html#l00007">use_tiles</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged__aoe_8cpp_source.html#l00044">execute_shaped_attack()</a>.</p>

</div>
</div>
<a id="ade9b38890f46ab6cbe94e1004f0ea5f1" name="ade9b38890f46ab6cbe94e1004f0ea5f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade9b38890f46ab6cbe94e1004f0ea5f1">&#9670;&nbsp;</a></span>execute_shaped_attack()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::execute_shaped_attack </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classshape.html">shape</a> &amp;&#160;</td>
          <td class="paramname"><em>sh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structprojectile.html">projectile</a> &amp;&#160;</td>
          <td class="paramname"><em>proj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> &amp;&#160;</td>
          <td class="paramname"><em>attacker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>AoE attack, with area given by shape. </p>

<p class="definition">Definition at line <a class="el" href="ranged__aoe_8cpp_source.html#l00044">44</a> of file <a class="el" href="ranged__aoe_8cpp_source.html">ranged_aoe.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>{</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="keyword">const</span> <span class="keyword">auto</span> sigdist_to_coverage = []( <span class="keyword">const</span> <span class="keywordtype">double</span> sigdist ) {</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="keywordflow">return</span> std::min( 1.0, -sigdist );</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    };</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="keyword">const</span> <span class="keyword">auto</span> aoe_permeable = [&amp;here]( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>        <span class="keywordflow">return</span> here.<a class="code hl_function" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) ||</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>               <span class="comment">// Necessary evil. TODO: Make map::shoot not evil.</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>               ( here.<a class="code hl_function" href="classmap.html#a2e43e061dcdfc249076b990a7f174c78">is_transparent</a>( p ) &amp;&amp; here.<a class="code hl_function" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd">TFLAG_PERMEABLE</a>, p ) );</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    };</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a> = sh.<a class="code hl_function" href="classshape.html#ae2f88d02730df890fb327ce57d86faac">get_origin</a>();</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    std::priority_queue&lt;tripoint_distance&gt; queue;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    std::map&lt;tripoint, aoe_flood_node&gt; <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>;</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    std::set&lt;tripoint&gt; closed;</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span> </div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1 ) ) {</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>        <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) ) {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        }</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    }</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    std::map&lt;tripoint, double&gt; final_coverage;</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="keywordflow">while</span>( !queue.empty() ) {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> p = queue.top().p;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>        queue.pop();</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        <span class="keywordflow">if</span>( closed.count( p ) != 0 || !here.<a class="code hl_function" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( p ) ) {</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        }</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        closed.insert( p );</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <span class="keywordtype">double</span> parent_coverage = <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( p ).parent_coverage;</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        <span class="keywordflow">if</span>( parent_coverage &lt;= 0.0 ) {</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        }</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        <span class="keywordtype">double</span> current_coverage = parent_coverage;</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        <span class="keywordflow">if</span>( aoe_permeable( p ) ) {</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="comment">// noop</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            <a class="code hl_struct" href="structprojectile.html">projectile</a> proj_copy = proj;</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>            here.<a class="code hl_function" href="classmap.html#a30089f97bb31ba2ca2243c178a4a3c65">shoot</a>( p, proj_copy, <span class="keyword">false</span> );</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>            <span class="comment">// There should be a nicer way than rechecking after shoot</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            <span class="keywordflow">if</span>( !aoe_permeable( p ) ) {</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span> </div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="keywordtype">float</span> total_dmg = proj_copy.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>            <span class="keywordtype">float</span> old_total_dmg = proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code hl_function" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="keywordflow">if</span>( old_total_dmg != total_dmg ) {</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>                current_coverage *= std::min( 1.0f, old_total_dmg / total_dmg );</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            }</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        }</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <span class="keywordflow">if</span>( current_coverage &gt; 0.0 ) {</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( p, 1 ) ) {</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>                <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>                <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( p, child ) &amp;&amp;</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>                    closed.count( child ) == 0 &amp;&amp;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>                    ( <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.count( child ) == 0 || <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( child ).parent_coverage &lt; current_coverage ) ) {</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>                    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( p, current_coverage );</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>                    queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>                }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>            }</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>            final_coverage[p] = current_coverage;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        }</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    }</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <a class="code hl_function" href="namespaceranged.html#a7a391700b761ffa6bc80dc0a998267cb">draw_cone_aoe</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, final_coverage );</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span> </div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="comment">// Here and not above because we want the animation first</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="comment">// Terrain will be shown damaged, but having it in unknown state would complicate timing the animation</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const tripoint, double&gt; &amp;pr : final_coverage ) {</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>        <a class="code hl_class" href="classCreature.html">Creature</a> *critter = <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;critter_at( pr.first );</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>            <a class="code hl_function" href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">ranged::hit_with_aoe</a>( *critter, &amp;attacker, proj.<a class="code hl_variable" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> );</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        }</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    }</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>}</div>
<div class="ttc" id="aclassCreature_html"><div class="ttname"><a href="classCreature.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00077">creature.h:78</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00388">map.h:389</a></div></div>
<div class="ttc" id="aclassmap_html_a09ef3e8c2e6664e3ed98d1e1e18a4b4f"><div class="ttname"><a href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">map::has_flag_furn</a></div><div class="ttdeci">bool has_flag_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02315">map.cpp:2315</a></div></div>
<div class="ttc" id="aclassmap_html_a2e43e061dcdfc249076b990a7f174c78"><div class="ttname"><a href="classmap.html#a2e43e061dcdfc249076b990a7f174c78">map::is_transparent</a></div><div class="ttdeci">bool is_transparent(const tripoint &amp;p) const</div><div class="ttdoc">Returns whether the tile at p is transparent(you can look past it).</div><div class="ttdef"><b>Definition:</b> <a href="lightmap_8cpp_source.html#l00626">lightmap.cpp:626</a></div></div>
<div class="ttc" id="aclassmap_html_a30089f97bb31ba2ca2243c178a4a3c65"><div class="ttname"><a href="classmap.html#a30089f97bb31ba2ca2243c178a4a3c65">map::shoot</a></div><div class="ttdeci">void shoot(const tripoint &amp;p, projectile &amp;proj, bool hit_items)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03710">map.cpp:3710</a></div></div>
<div class="ttc" id="aclassmap_html_a46608709f68358365d0734b1063fed73"><div class="ttname"><a href="classmap.html#a46608709f68358365d0734b1063fed73">map::inbounds</a></div><div class="ttdeci">virtual bool inbounds(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l07748">map.cpp:7748</a></div></div>
<div class="ttc" id="aclassmap_html_a4f5f812d7e89a998429958573a4c340f"><div class="ttname"><a href="classmap.html#a4f5f812d7e89a998429958573a4c340f">map::points_in_radius</a></div><div class="ttdeci">tripoint_range&lt; tripoint &gt; points_in_radius(const tripoint &amp;center, size_t radius, size_t radiusz=0) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l08597">map.cpp:8597</a></div></div>
<div class="ttc" id="aclassmap_html_af563dc2397e71a053569cb45c6bb7e77"><div class="ttname"><a href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">map::passable</a></div><div class="ttdeci">bool passable(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01798">map.cpp:1798</a></div></div>
<div class="ttc" id="aclassshape_html_ad3d343b71c2a680f80bcd741e4c54b06"><div class="ttname"><a href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">shape::distance_at</a></div><div class="ttdeci">double distance_at(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="shape_8cpp_source.html#l00037">shape.cpp:37</a></div></div>
<div class="ttc" id="aclassshape_html_ae2f88d02730df890fb327ce57d86faac"><div class="ttname"><a href="classshape.html#ae2f88d02730df890fb327ce57d86faac">shape::get_origin</a></div><div class="ttdeci">const tripoint &amp; get_origin() const</div><div class="ttdef"><b>Definition:</b> <a href="shape_8cpp_source.html#l00016">shape.cpp:16</a></div></div>
<div class="ttc" id="ahandle__action_8cpp_html_a18a5c5b03ba964c4d5d06e062510c99c"><div class="ttname"><a href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a></div><div class="ttdeci">static void open()</div><div class="ttdef"><b>Definition:</b> <a href="handle__action_8cpp_source.html#l00509">handle_action.cpp:509</a></div></div>
<div class="ttc" id="aline_8h_html_ac316ae5a3a80221fde94d96fd20b3252"><div class="ttname"><a href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a></div><div class="ttdeci">int trig_dist_squared(const tripoint &amp;loc1, const tripoint &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00136">line.h:136</a></div></div>
<div class="ttc" id="amap_8cpp_html_acb0b34be6e497bdd2f9f40ae6929d562"><div class="ttname"><a href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00145">map.cpp:145</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd">TFLAG_PERMEABLE</a></div><div class="ttdeci">@ TFLAG_PERMEABLE</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00304">mapdata.h:304</a></div></div>
<div class="ttc" id="anamespaceranged_html_a51e6279a2008714e5596da4f5fa1b00e"><div class="ttname"><a href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">ranged::hit_with_aoe</a></div><div class="ttdeci">dealt_damage_instance hit_with_aoe(Creature &amp;target, Creature *source, const damage_instance &amp;di)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00615">creature.cpp:615</a></div></div>
<div class="ttc" id="anamespaceranged_html_a7a391700b761ffa6bc80dc0a998267cb"><div class="ttname"><a href="namespaceranged.html#a7a391700b761ffa6bc80dc0a998267cb">ranged::draw_cone_aoe</a></div><div class="ttdeci">void draw_cone_aoe(const tripoint &amp;origin, const std::map&lt; tripoint, double &gt; &amp;aoe)</div><div class="ttdef"><b>Definition:</b> <a href="animation_8cpp_source.html#l01076">animation.cpp:1076</a></div></div>
<div class="ttc" id="astructaoe__flood__node_html"><div class="ttname"><a href="structaoe__flood__node.html">aoe_flood_node</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged__aoe_8cpp_source.html#l00030">ranged_aoe.cpp:30</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a96f6f6d008ed8744ce549cefcfec3951"><div class="ttname"><a href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">damage_instance::total_damage</a></div><div class="ttdeci">float total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00075">damage.cpp:75</a></div></div>
<div class="ttc" id="astructprojectile_html"><div class="ttname"><a href="structprojectile.html">projectile</a></div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00020">projectile.h:20</a></div></div>
<div class="ttc" id="astructprojectile_html_a82d8f657f8cfc4e180c15bfab8ca8a6e"><div class="ttname"><a href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">projectile::impact</a></div><div class="ttdeci">damage_instance impact</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00021">projectile.h:21</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00147">point.h:147</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="shape_8cpp_source.html#l00037">shape::distance_at()</a>, <a class="el" href="animation_8cpp_source.html#l01076">draw_cone_aoe()</a>, <a class="el" href="game_8cpp_source.html#l00272">g</a>, <a class="el" href="map_8cpp_source.html#l00145">get_map()</a>, <a class="el" href="shape_8cpp_source.html#l00016">shape::get_origin()</a>, <a class="el" href="map_8cpp_source.html#l02315">map::has_flag_furn()</a>, <a class="el" href="creature_8cpp_source.html#l00615">hit_with_aoe()</a>, <a class="el" href="projectile_8h_source.html#l00021">projectile::impact</a>, <a class="el" href="map_8cpp_source.html#l07748">map::inbounds()</a>, <a class="el" href="lightmap_8cpp_source.html#l00626">map::is_transparent()</a>, <a class="el" href="handle__action_8cpp_source.html#l00509">open()</a>, <a class="el" href="map_8cpp_source.html#l01798">map::passable()</a>, <a class="el" href="map_8cpp_source.html#l08597">map::points_in_radius()</a>, <a class="el" href="map_8cpp_source.html#l03710">map::shoot()</a>, <a class="el" href="mapdata_8h_source.html#l00304">TFLAG_PERMEABLE</a>, <a class="el" href="damage_8cpp_source.html#l00075">damage_instance::total_damage()</a>, and <a class="el" href="line_8h_source.html#l00136">trig_dist_squared()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00810">player::fire_gun()</a>.</p>

</div>
</div>
<a id="a7b4da33d1d9391123845f299f1f156dc" name="a7b4da33d1d9391123845f299f1f156dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b4da33d1d9391123845f299f1f156dc">&#9670;&nbsp;</a></span>expected_coverage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt; <a class="el" href="structtripoint.html">tripoint</a>, double &gt; ranged::expected_coverage </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classshape.html">shape</a> &amp;&#160;</td>
          <td class="paramname"><em>sh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmap.html">map</a> &amp;&#160;</td>
          <td class="paramname"><em>here</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>bash_power</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged__aoe_8cpp_source.html#l00129">129</a> of file <a class="el" href="ranged__aoe_8cpp_source.html">ranged_aoe.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>{</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keyword">const</span> <span class="keyword">auto</span> sigdist_to_coverage = []( <span class="keyword">const</span> <span class="keywordtype">double</span> sigdist ) {</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        <span class="keywordflow">return</span> std::min( 1.0, -sigdist );</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    };</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a> = sh.<a class="code hl_function" href="classshape.html#ae2f88d02730df890fb327ce57d86faac">get_origin</a>();</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    std::priority_queue&lt;tripoint_distance&gt; queue;</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    std::map&lt;tripoint, aoe_flood_node&gt; <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>;</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    std::set&lt;tripoint&gt; closed;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1 ) ) {</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>        <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>        <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) ) {</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>            <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>            queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    }</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[<a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, 1.0 );</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    std::map&lt;tripoint, double&gt; final_coverage;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keywordflow">while</span>( !queue.empty() ) {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> p = queue.top().p;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        queue.pop();</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        <span class="keywordflow">if</span>( closed.count( p ) != 0 ) {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        }</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        closed.insert( p );</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        <span class="keywordtype">double</span> parent_coverage = <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( p ).parent_coverage;</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        <span class="keywordflow">if</span>( parent_coverage &lt;= 0.0 ) {</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        }</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <span class="keywordtype">double</span> current_coverage = parent_coverage;</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) ||</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>            <span class="comment">// Necessary evil. TODO: Make map::shoot not evil.</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            ( here.<a class="code hl_function" href="classmap.html#a2e43e061dcdfc249076b990a7f174c78">is_transparent</a>( p ) &amp;&amp; here.<a class="code hl_function" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258a17333b0108a536601f817c86278e77bd">TFLAG_PERMEABLE</a>, p ) ) ) {</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>            <span class="comment">// noop</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>            <span class="keywordtype">int</span> bash_str = here.<a class="code hl_function" href="classmap.html#a0b83bb9cbf7265f78eaad06dc1f7b8c3">bash_strength</a>( p );</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>            <span class="keywordtype">int</span> bash_res = here.<a class="code hl_function" href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">bash_resistance</a>( p );</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <span class="keywordflow">if</span>( bash_power &lt; bash_res ) {</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            }</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>            <span class="keywordtype">int</span> range_width = bash_str - bash_res + 1;</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            <span class="keywordtype">int</span> fail_width = bash_str - bash_power;</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <span class="keywordtype">double</span> fail_chance = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( fail_width ) / ( range_width );</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>            current_coverage *= 1.0 - std::max( 0.0, fail_chance );</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        }</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <span class="keywordflow">if</span>( here.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p ) ) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            <span class="comment">// If a vehicle part is blocking, assume it&#39;s indestructible</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        }</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <span class="keywordflow">if</span>( current_coverage &gt; 0.0 ) {</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;child : here.<a class="code hl_function" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( p, 1 ) ) {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>                <span class="keywordtype">double</span> coverage = sigdist_to_coverage( sh.<a class="code hl_function" href="classshape.html#ad3d343b71c2a680f80bcd741e4c54b06">distance_at</a>( child ) );</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>                <span class="keywordflow">if</span>( coverage &gt; 0.0 &amp;&amp; !<a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>().obstructed_by_vehicle_rotation( p, child ) &amp;&amp;</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>                    closed.count( child ) == 0 &amp;&amp;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>                    ( <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.count( child ) == 0 || <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>.at( child ).parent_coverage &lt; current_coverage ) ) {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>                    <a class="code hl_function" href="handle__action_8cpp.html#a18a5c5b03ba964c4d5d06e062510c99c">open</a>[child] = <a class="code hl_struct" href="structaoe__flood__node.html">aoe_flood_node</a>( p, current_coverage );</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>                    queue.emplace( child, <a class="code hl_function" href="line_8h.html#ac316ae5a3a80221fde94d96fd20b3252">trig_dist_squared</a>( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a>, child ) );</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>                }</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>            }</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>            final_coverage[p] = current_coverage;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        }</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    }</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    final_coverage.erase( <a class="code hl_enumeration" href="namespacecoords.html#ad99808a305ad40299e592d1266bed4a7">origin</a> );</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="keywordflow">return</span> final_coverage;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>}</div>
<div class="ttc" id="aclassmap_html_a0b83bb9cbf7265f78eaad06dc1f7b8c3"><div class="ttname"><a href="classmap.html#a0b83bb9cbf7265f78eaad06dc1f7b8c3">map::bash_strength</a></div><div class="ttdeci">int bash_strength(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns max_str of the furniture or terrain at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02447">map.cpp:2447</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01007">map.cpp:1007</a></div></div>
<div class="ttc" id="aclassmap_html_adfb4f21d749696fdd25c7b37ba2b7b21"><div class="ttname"><a href="classmap.html#adfb4f21d749696fdd25c7b37ba2b7b21">map::bash_resistance</a></div><div class="ttdeci">int bash_resistance(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns min_str of the furniture or terrain at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02461">map.cpp:2461</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="map_8cpp_source.html#l02461">map::bash_resistance()</a>, <a class="el" href="map_8cpp_source.html#l02447">map::bash_strength()</a>, <a class="el" href="shape_8cpp_source.html#l00037">shape::distance_at()</a>, <a class="el" href="map_8cpp_source.html#l00145">get_map()</a>, <a class="el" href="shape_8cpp_source.html#l00016">shape::get_origin()</a>, <a class="el" href="map_8cpp_source.html#l02315">map::has_flag_furn()</a>, <a class="el" href="lightmap_8cpp_source.html#l00626">map::is_transparent()</a>, <a class="el" href="handle__action_8cpp_source.html#l00509">open()</a>, <a class="el" href="map_8cpp_source.html#l01798">map::passable()</a>, <a class="el" href="map_8cpp_source.html#l08597">map::points_in_radius()</a>, <a class="el" href="mapdata_8h_source.html#l00304">TFLAG_PERMEABLE</a>, <a class="el" href="line_8h_source.html#l00136">trig_dist_squared()</a>, and <a class="el" href="map_8cpp_source.html#l01007">map::veh_at()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l02533">target_ui::set_cursor_pos()</a>.</p>

</div>
</div>
<a id="a4c8c85e0249f67213d9994612315aa3e" name="a4c8c85e0249f67213d9994612315aa3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c8c85e0249f67213d9994612315aa3e">&#9670;&nbsp;</a></span>get_str_draw_penalty()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::get_str_draw_penalty </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Penalties potentially incurred by STR_DRAW weapons. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00996">996</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>{</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="comment">// We only care if weapon has STR_DRAW, and that the user is weaker than required strength.</span></div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>    <span class="comment">// Also avoid dividing by zero, and skip if we&#39;d just get a result of 1 anyway.</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    }</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="comment">// We also don&#39;t want to actually reduce values to zero, even if user is debuffed to zero strength.</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <span class="keywordtype">float</span> archer_str = std::max( 1, p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() );</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    <span class="keywordflow">return</span> ( archer_str / it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() );</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>}</div>
<div class="ttc" id="aclassitem_html_a2899a37f781e1efea9465a98277141c7"><div class="ttname"><a href="classitem.html#a2899a37f781e1efea9465a98277141c7">item::get_min_str</a></div><div class="ttdeci">int get_min_str() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09892">item.cpp:9892</a></div></div>
<div class="ttc" id="aclassitem_html_aaa5aeb6f838927babb10ede535cf2a73"><div class="ttname"><a href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">item::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05213">item.cpp:5213</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a3756f1dde5d862fe1b0f0240dfc13e6a"><div class="ttname"><a href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a></div><div class="ttdeci">static const std::string flag_STR_DRAW(&quot;STR_DRAW&quot;)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l09892">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04064">Character::get_str()</a>, and <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="item_8cpp_source.html#l01469">item::basic_info()</a>, <a class="el" href="ranged_8cpp_source.html#l03659">gunmode_checks_common()</a>, <a class="el" href="ranged_8cpp_source.html#l01008">str_draw_damage_modifier()</a>, <a class="el" href="ranged_8cpp_source.html#l01022">str_draw_dispersion_modifier()</a>, and <a class="el" href="ranged_8cpp_source.html#l01034">str_draw_range_modifier()</a>.</p>

</div>
</div>
<a id="aed4420a1fd77e160a72de2a528e56da5" name="aed4420a1fd77e160a72de2a528e56da5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed4420a1fd77e160a72de2a528e56da5">&#9670;&nbsp;</a></span>gunmode_checks_common()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ranged::gunmode_checks_common </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classavatar.html">avatar</a> &amp;&#160;</td>
          <td class="paramname"><em>you</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmap.html">map</a> &amp;&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;&#160;</td>
          <td class="paramname"><em>gmode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Common checks for gunmode (when firing a weapon / manually firing turret) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">messages</td><td>Used to store messages describing failed checks </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if all conditions are true </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03659">3659</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03661" name="l03661"></a><span class="lineno"> 3661</span>{</div>
<div class="line"><a id="l03662" name="l03662"></a><span class="lineno"> 3662</span>    <span class="keywordtype">bool</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03663" name="l03663"></a><span class="lineno"> 3663</span> </div>
<div class="line"><a id="l03664" name="l03664"></a><span class="lineno"> 3664</span>    <span class="comment">// Check that passed gun mode is valid and we are able to use it</span></div>
<div class="line"><a id="l03665" name="l03665"></a><span class="lineno"> 3665</span>    <span class="keywordflow">if</span>( !( gmode &amp;&amp; you.<a class="code hl_function" href="classCharacter.html#a4eddeb86babf626e7869882079b40651">can_use</a>( *gmode ) ) ) {</div>
<div class="line"><a id="l03666" name="l03666"></a><span class="lineno"> 3666</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You can&#39;t currently fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03667" name="l03667"></a><span class="lineno"> 3667</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03668" name="l03668"></a><span class="lineno"> 3668</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03669" name="l03669"></a><span class="lineno"> 3669</span>    }</div>
<div class="line"><a id="l03670" name="l03670"></a><span class="lineno"> 3670</span> </div>
<div class="line"><a id="l03671" name="l03671"></a><span class="lineno"> 3671</span>    <span class="keyword">const</span> <a class="code hl_class" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l03672" name="l03672"></a><span class="lineno"> 3672</span>    <span class="keywordflow">if</span>( vp &amp;&amp; vp-&gt;vehicle().player_in_control( you ) &amp;&amp; ( gmode-&gt;<a class="code hl_function" href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">is_two_handed</a>( you ) ||</div>
<div class="line"><a id="l03673" name="l03673"></a><span class="lineno"> 3673</span>            gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a> ) ) ) {</div>
<div class="line"><a id="l03674" name="l03674"></a><span class="lineno"> 3674</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You can&#39;t fire your %s while driving.&quot;</span> ),</div>
<div class="line"><a id="l03675" name="l03675"></a><span class="lineno"> 3675</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03676" name="l03676"></a><span class="lineno"> 3676</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03677" name="l03677"></a><span class="lineno"> 3677</span>    }</div>
<div class="line"><a id="l03678" name="l03678"></a><span class="lineno"> 3678</span> </div>
<div class="line"><a id="l03679" name="l03679"></a><span class="lineno"> 3679</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a> ) &amp;&amp; ( !you.<a class="code hl_function" href="classCharacter.html#a8e2d2e1c01bfbb36401ae221300370f5">has_two_arms</a>() ||</div>
<div class="line"><a id="l03680" name="l03680"></a><span class="lineno"> 3680</span>            you.<a class="code hl_function" href="classCharacter.html#a3aaa75382f6308a729369c7f2ccf0600">worn_with_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a> ) ) ) {</div>
<div class="line"><a id="l03681" name="l03681"></a><span class="lineno"> 3681</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You need two free hands to fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03682" name="l03682"></a><span class="lineno"> 3682</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03683" name="l03683"></a><span class="lineno"> 3683</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03684" name="l03684"></a><span class="lineno"> 3684</span>    }</div>
<div class="line"><a id="l03685" name="l03685"></a><span class="lineno"> 3685</span> </div>
<div class="line"><a id="l03686" name="l03686"></a><span class="lineno"> 3686</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( *gmode, you ) &lt; 0.5f ) {</div>
<div class="line"><a id="l03687" name="l03687"></a><span class="lineno"> 3687</span>        messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have enough strength to fire your %s.&quot;</span> ),</div>
<div class="line"><a id="l03688" name="l03688"></a><span class="lineno"> 3688</span>                                           gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03689" name="l03689"></a><span class="lineno"> 3689</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03690" name="l03690"></a><span class="lineno"> 3690</span>    }</div>
<div class="line"><a id="l03691" name="l03691"></a><span class="lineno"> 3691</span> </div>
<div class="line"><a id="l03692" name="l03692"></a><span class="lineno"> 3692</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l03693" name="l03693"></a><span class="lineno"> 3693</span>}</div>
<div class="ttc" id="aclassCharacter_html_a3aaa75382f6308a729369c7f2ccf0600"><div class="ttname"><a href="classCharacter.html#a3aaa75382f6308a729369c7f2ccf0600">Character::worn_with_flag</a></div><div class="ttdeci">bool worn_with_flag(const std::string &amp;flag, const bodypart_id &amp;bp=bodypart_str_id::NULL_ID()) const</div><div class="ttdoc">Returns true if the player is wearing an item with the given flag.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03270">character.cpp:3270</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eddeb86babf626e7869882079b40651"><div class="ttname"><a href="classCharacter.html#a4eddeb86babf626e7869882079b40651">Character::can_use</a></div><div class="ttdeci">bool can_use(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks if character stats and skills meet minimum requirements for the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02917">character.cpp:2917</a></div></div>
<div class="ttc" id="aclassCharacter_html_a8e2d2e1c01bfbb36401ae221300370f5"><div class="ttname"><a href="classCharacter.html#a8e2d2e1c01bfbb36401ae221300370f5">Character::has_two_arms</a></div><div class="ttdeci">bool has_two_arms() const</div><div class="ttdoc">Returns true if the player has two functioning arms.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01280">character.cpp:1280</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad24859164517ed6e392e21df69527199"><div class="ttname"><a href="classCharacter.html#ad24859164517ed6e392e21df69527199">Character::pos</a></div><div class="ttdeci">const tripoint &amp; pos() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00714">character.cpp:714</a></div></div>
<div class="ttc" id="aclassitem_html_a7e78e26dcf9b357cda769c3ca2938eda"><div class="ttname"><a href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">item::tname</a></div><div class="ttdeci">std::string tname(unsigned int quantity=1, bool with_prefix=true, unsigned int truncate=0) const</div><div class="ttdoc">Return the (translated) item name.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04465">item.cpp:4465</a></div></div>
<div class="ttc" id="aclassitem_html_af373f646c1ee172941490dc7cc04bbcd"><div class="ttname"><a href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">item::is_two_handed</a></div><div class="ttdeci">bool is_two_handed(const Character &amp;guy) const</div><div class="ttdoc">Whether the character needs both hands to wield this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06275">item.cpp:6275</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html"><div class="ttname"><a href="classoptional__vpart__position.html">optional_vpart_position</a></div><div class="ttdoc">Simple wrapper to forward functions that may return a cata::optional to vpart_position.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00101">vpart_position.h:102</a></div></div>
<div class="ttc" id="anamespacedetail_1_1digits_html_aad69d2373aa047bdd9e81494bf3da5ae"><div class="ttname"><a href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">detail::digits::result</a></div><div class="ttdeci">result</div><div class="ttdef"><b>Definition:</b> <a href="fmtlib__format-inl_8h_source.html#l01626">fmtlib_format-inl.h:1626</a></div></div>
<div class="ttc" id="anamespaceranged_html_a4c8c85e0249f67213d9994612315aa3e"><div class="ttname"><a href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a></div><div class="ttdeci">float get_str_draw_penalty(const item &amp;it, const Character &amp;p)</div><div class="ttdoc">Penalties potentially incurred by STR_DRAW weapons.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00996">ranged.cpp:996</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a02edfa7a6cb1a0f7a67ae1aca7a34753"><div class="ttname"><a href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND</a></div><div class="ttdeci">static const std::string flag_FIRE_TWOHAND(&quot;FIRE_TWOHAND&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aeac06317fd010c6001b6b71968bc15c1"><div class="ttname"><a href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS</a></div><div class="ttdeci">static const std::string flag_RESTRICT_HANDS(&quot;RESTRICT_HANDS&quot;)</div></div>
<div class="ttc" id="astring__formatter_8h_html_a9b089d0b697443b096063219dab08ef5"><div class="ttname"><a href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a></div><div class="ttdeci">std::string string_format(std::string format, Args &amp;&amp;...args)</div><div class="ttdoc">Simple wrapper over string_formatter::parse.</div><div class="ttdef"><b>Definition:</b> <a href="string__formatter_8h_source.html#l00418">string_formatter.h:418</a></div></div>
<div class="ttc" id="atranslations_8h_html_aa829053017e23ef22d44dccecba63a34"><div class="ttname"><a href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a></div><div class="ttdeci">#define _(msg)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00116">translations.h:116</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="character_8cpp_source.html#l02917">Character::can_use()</a>, <a class="el" href="ranged_8cpp.html#a02edfa7a6cb1a0f7a67ae1aca7a34753">flag_FIRE_TWOHAND()</a>, <a class="el" href="ranged_8cpp.html#aeac06317fd010c6001b6b71968bc15c1">flag_RESTRICT_HANDS()</a>, <a class="el" href="ranged_8cpp_source.html#l00996">get_str_draw_penalty()</a>, <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>, <a class="el" href="character_8cpp_source.html#l01280">Character::has_two_arms()</a>, <a class="el" href="item_8cpp_source.html#l06275">item::is_two_handed()</a>, <a class="el" href="character_8cpp_source.html#l00714">Character::pos()</a>, <a class="el" href="string__formatter_8h_source.html#l00418">string_format()</a>, <a class="el" href="item_8cpp_source.html#l04465">item::tname()</a>, <a class="el" href="map_8cpp_source.html#l01007">map::veh_at()</a>, and <a class="el" href="character_8cpp_source.html#l03270">Character::worn_with_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="avatar__action_8cpp_source.html#l00657">can_fire_turret()</a>, <a class="el" href="avatar__action_8cpp_source.html#l00619">avatar_action::can_fire_weapon()</a>, and <a class="el" href="ranged_8cpp_source.html#l02747">target_ui::update_status()</a>.</p>

</div>
</div>
<a id="a743f9e35b20c136e56ca9e9480fb27bc" name="a743f9e35b20c136e56ca9e9480fb27bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a743f9e35b20c136e56ca9e9480fb27bc">&#9670;&nbsp;</a></span>gunmode_checks_weapon()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ranged::gunmode_checks_weapon </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classavatar.html">avatar</a> &amp;&#160;</td>
          <td class="paramname"><em>you</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classmap.html">map</a> &amp;&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::string &gt; &amp;&#160;</td>
          <td class="paramname"><em>messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classgun__mode.html">gun_mode</a> &amp;&#160;</td>
          <td class="paramname"><em>gmode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Various checks for gunmode when firing a weapon. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">messages</td><td>Used to store messages describing failed checks </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if all conditions are true </dd></dl>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03695">3695</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03697" name="l03697"></a><span class="lineno"> 3697</span>{</div>
<div class="line"><a id="l03698" name="l03698"></a><span class="lineno"> 3698</span>    <span class="keywordtype">bool</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03699" name="l03699"></a><span class="lineno"> 3699</span> </div>
<div class="line"><a id="l03700" name="l03700"></a><span class="lineno"> 3700</span>    <span class="keywordflow">if</span>( !gmode-&gt;<a class="code hl_function" href="classitem.html#a8efcfdc21aadbc25a8cc95cf54685489">ammo_sufficient</a>() &amp;&amp; !gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a id="l03701" name="l03701"></a><span class="lineno"> 3701</span>        <span class="keywordflow">if</span>( !gmode-&gt;<a class="code hl_function" href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">ammo_remaining</a>() ) {</div>
<div class="line"><a id="l03702" name="l03702"></a><span class="lineno"> 3702</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is empty!&quot;</span> ), gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03703" name="l03703"></a><span class="lineno"> 3703</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03704" name="l03704"></a><span class="lineno"> 3704</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s needs %i charges to fire!&quot;</span> ),</div>
<div class="line"><a id="l03705" name="l03705"></a><span class="lineno"> 3705</span>                                               gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), gmode-&gt;<a class="code hl_function" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) );</div>
<div class="line"><a id="l03706" name="l03706"></a><span class="lineno"> 3706</span>        }</div>
<div class="line"><a id="l03707" name="l03707"></a><span class="lineno"> 3707</span>        <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03708" name="l03708"></a><span class="lineno"> 3708</span>    }</div>
<div class="line"><a id="l03709" name="l03709"></a><span class="lineno"> 3709</span> </div>
<div class="line"><a id="l03710" name="l03710"></a><span class="lineno"> 3710</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>() &gt; 0 ) {</div>
<div class="line"><a id="l03711" name="l03711"></a><span class="lineno"> 3711</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> ups_drain = gmode-&gt;<a class="code hl_function" href="classitem.html#af6bd135500675d45eb9b79b196d9558e">get_gun_ups_drain</a>();</div>
<div class="line"><a id="l03712" name="l03712"></a><span class="lineno"> 3712</span>        <span class="keyword">const</span> <span class="keywordtype">int</span> adv_ups_drain = std::max( 1, ups_drain * 3 / 5 );</div>
<div class="line"><a id="l03713" name="l03713"></a><span class="lineno"> 3713</span>        <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03714" name="l03714"></a><span class="lineno"> 3714</span>        <span class="keywordflow">if</span>( you.<a class="code hl_function" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a id="l03715" name="l03715"></a><span class="lineno"> 3715</span>            <a class="code hl_class" href="classmonster.html">monster</a> *mons = <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>().<a class="code hl_variable" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a id="l03716" name="l03716"></a><span class="lineno"> 3716</span>            <span class="keywordflow">if</span>( !mons-&gt;<a class="code hl_variable" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code hl_variable" href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mech_weapon</a>.<a class="code hl_function" href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">is_empty</a>() ) {</div>
<div class="line"><a id="l03717" name="l03717"></a><span class="lineno"> 3717</span>                is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a id="l03718" name="l03718"></a><span class="lineno"> 3718</span>            }</div>
<div class="line"><a id="l03719" name="l03719"></a><span class="lineno"> 3719</span>        }</div>
<div class="line"><a id="l03720" name="l03720"></a><span class="lineno"> 3720</span>        <span class="keywordflow">if</span>( !is_mech_weapon ) {</div>
<div class="line"><a id="l03721" name="l03721"></a><span class="lineno"> 3721</span>            <span class="keywordflow">if</span>( !( you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a>, ups_drain ) ||</div>
<div class="line"><a id="l03722" name="l03722"></a><span class="lineno"> 3722</span>                   you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a>, adv_ups_drain ) ||</div>
<div class="line"><a id="l03723" name="l03723"></a><span class="lineno"> 3723</span>                   ( you.<a class="code hl_function" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code hl_variable" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a> ) &amp;&amp;</div>
<div class="line"><a id="l03724" name="l03724"></a><span class="lineno"> 3724</span>                     you.<a class="code hl_function" href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">get_power_level</a>() &gt;= <a class="code hl_function" href="namespaceunits.html#ada24d52c1ffd0df8d52a363d013d3231">units::from_kilojoule</a>( ups_drain ) ) ) ) {</div>
<div class="line"><a id="l03725" name="l03725"></a><span class="lineno"> 3725</span>                messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>(</div>
<div class="line"><a id="l03726" name="l03726"></a><span class="lineno"> 3726</span>                                        <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You need a UPS with at least %2$d charges or an advanced UPS with at least %3$d charges to fire the %1$s!&quot;</span> ),</div>
<div class="line"><a id="l03727" name="l03727"></a><span class="lineno"> 3727</span>                                        gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), ups_drain, adv_ups_drain ) );</div>
<div class="line"><a id="l03728" name="l03728"></a><span class="lineno"> 3728</span>                <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03729" name="l03729"></a><span class="lineno"> 3729</span>            }</div>
<div class="line"><a id="l03730" name="l03730"></a><span class="lineno"> 3730</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03731" name="l03731"></a><span class="lineno"> 3731</span>            <span class="keywordflow">if</span>( !you.<a class="code hl_function" href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">has_charges</a>( <a class="code hl_variable" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, ups_drain ) ) {</div>
<div class="line"><a id="l03732" name="l03732"></a><span class="lineno"> 3732</span>                messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your mech has an empty battery, its %s will not fire.&quot;</span> ),</div>
<div class="line"><a id="l03733" name="l03733"></a><span class="lineno"> 3733</span>                                                   gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03734" name="l03734"></a><span class="lineno"> 3734</span>                <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03735" name="l03735"></a><span class="lineno"> 3735</span>            }</div>
<div class="line"><a id="l03736" name="l03736"></a><span class="lineno"> 3736</span>        }</div>
<div class="line"><a id="l03737" name="l03737"></a><span class="lineno"> 3737</span>    }</div>
<div class="line"><a id="l03738" name="l03738"></a><span class="lineno"> 3738</span> </div>
<div class="line"><a id="l03739" name="l03739"></a><span class="lineno"> 3739</span>    <span class="keywordflow">if</span>( gmode-&gt;<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a> ) ) {</div>
<div class="line"><a id="l03740" name="l03740"></a><span class="lineno"> 3740</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> v_mountable = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>( m.<a class="code hl_function" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() ).<a class="code hl_function" href="classoptional__vpart__position.html#a2f0829fa83c2c4d3007e26b91af11856">part_with_feature</a>( <span class="stringliteral">&quot;MOUNTABLE&quot;</span>,</div>
<div class="line"><a id="l03741" name="l03741"></a><span class="lineno"> 3741</span>                                 <span class="keyword">true</span> ) );</div>
<div class="line"><a id="l03742" name="l03742"></a><span class="lineno"> 3742</span>        <span class="keywordtype">bool</span> t_mountable = m.<a class="code hl_function" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code hl_function" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a>, you.<a class="code hl_function" href="classCharacter.html#ad24859164517ed6e392e21df69527199">pos</a>() );</div>
<div class="line"><a id="l03743" name="l03743"></a><span class="lineno"> 3743</span>        <span class="keywordflow">if</span>( !t_mountable &amp;&amp; !v_mountable &amp;&amp; !( you.<a class="code hl_function" href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">get_size</a>() &gt; <a class="code hl_enumvalue" href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a> ) ) {</div>
<div class="line"><a id="l03744" name="l03744"></a><span class="lineno"> 3744</span>            messages.push_back( <a class="code hl_function" href="string__formatter_8h.html#a9b089d0b697443b096063219dab08ef5">string_format</a>(</div>
<div class="line"><a id="l03745" name="l03745"></a><span class="lineno"> 3745</span>                                    <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You must stand near acceptable terrain or furniture to fire the %s.  A table, a mound of dirt, a broken window, etc.&quot;</span> ),</div>
<div class="line"><a id="l03746" name="l03746"></a><span class="lineno"> 3746</span>                                    gmode-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() ) );</div>
<div class="line"><a id="l03747" name="l03747"></a><span class="lineno"> 3747</span>            <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l03748" name="l03748"></a><span class="lineno"> 3748</span>        }</div>
<div class="line"><a id="l03749" name="l03749"></a><span class="lineno"> 3749</span>    }</div>
<div class="line"><a id="l03750" name="l03750"></a><span class="lineno"> 3750</span> </div>
<div class="line"><a id="l03751" name="l03751"></a><span class="lineno"> 3751</span>    <span class="keywordflow">return</span> <a class="code hl_enumeration" href="namespacedetail_1_1digits.html#aad69d2373aa047bdd9e81494bf3da5ae">result</a>;</div>
<div class="line"><a id="l03752" name="l03752"></a><span class="lineno"> 3752</span>}</div>
<div class="ttc" id="acharacter_8cpp_html_a2fcb25d686f4a35fca374c6f71280311"><div class="ttname"><a href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a></div><div class="ttdeci">Character &amp; get_player_character()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00387">character.cpp:387</a></div></div>
<div class="ttc" id="aclassCharacter_html_a67b51491c2529df09755e07bc633cc55"><div class="ttname"><a href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">Character::is_mounted</a></div><div class="ttdeci">bool is_mounted() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01143">character.cpp:1143</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9bff3208a5e121c4e3a71b81b378e4e7"><div class="ttname"><a href="classCharacter.html#a9bff3208a5e121c4e3a71b81b378e4e7">Character::has_charges</a></div><div class="ttdeci">bool has_charges(const itype_id &amp;it, int quantity, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09598">character.cpp:9598</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa5ca0f6c4fb1c08bb93ece1c9746c368"><div class="ttname"><a href="classCharacter.html#aa5ca0f6c4fb1c08bb93ece1c9746c368">Character::get_size</a></div><div class="ttdeci">m_size get_size() const override</div><div class="ttdoc">Get size class of character.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00541">character.cpp:541</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac3d46549b7cdaac1f98991167ad5f1b3"><div class="ttname"><a href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">Character::mounted_creature</a></div><div class="ttdeci">shared_ptr_fast&lt; monster &gt; mounted_creature</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01556">character.h:1556</a></div></div>
<div class="ttc" id="aclassCharacter_html_add22510ff2fa20a662868b4dd86e030e"><div class="ttname"><a href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">Character::get_power_level</a></div><div class="ttdeci">units::energy get_power_level() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01967">character.cpp:1967</a></div></div>
<div class="ttc" id="aclassCharacter_html_af9c7419575e23d52745c94009929fafb"><div class="ttname"><a href="classCharacter.html#af9c7419575e23d52745c94009929fafb">Character::has_active_bionic</a></div><div class="ttdeci">bool has_active_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id and it is powered on.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01887">character.cpp:1887</a></div></div>
<div class="ttc" id="aclassitem_html_a26c025fd4909bd31c8e91ed87905507b"><div class="ttname"><a href="classitem.html#a26c025fd4909bd31c8e91ed87905507b">item::ammo_remaining</a></div><div class="ttdeci">int ammo_remaining() const</div><div class="ttdoc">Quantity of ammunition currently loaded in tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07247">item.cpp:7247</a></div></div>
<div class="ttc" id="aclassitem_html_a7dc5d9ccf5638ae80cebe1864050fa26"><div class="ttname"><a href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">item::ammo_required</a></div><div class="ttdeci">int ammo_required() const</div><div class="ttdoc">Quantity of ammunition consumed per usage of tool or with each shot of gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07317">item.cpp:7317</a></div></div>
<div class="ttc" id="aclassitem_html_a8efcfdc21aadbc25a8cc95cf54685489"><div class="ttname"><a href="classitem.html#a8efcfdc21aadbc25a8cc95cf54685489">item::ammo_sufficient</a></div><div class="ttdeci">bool ammo_sufficient(int qty=1) const</div><div class="ttdoc">Check if sufficient ammo is loaded for given number of uses.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07340">item.cpp:7340</a></div></div>
<div class="ttc" id="aclassitem_html_af6bd135500675d45eb9b79b196d9558e"><div class="ttname"><a href="classitem.html#af6bd135500675d45eb9b79b196d9558e">item::get_gun_ups_drain</a></div><div class="ttdeci">int get_gun_ups_drain() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09780">item.cpp:9780</a></div></div>
<div class="ttc" id="aclassmap_html_a516c0764134cc86b57297811520395f7"><div class="ttname"><a href="classmap.html#a516c0764134cc86b57297811520395f7">map::has_flag_ter_or_furn</a></div><div class="ttdeci">bool has_flag_ter_or_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02320">map.cpp:2320</a></div></div>
<div class="ttc" id="aclassmonster_html"><div class="ttname"><a href="classmonster.html">monster</a></div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00084">monster.h:85</a></div></div>
<div class="ttc" id="aclassmonster_html_aa30f973bf524ba275ada847f6118b048"><div class="ttname"><a href="classmonster.html#aa30f973bf524ba275ada847f6118b048">monster::type</a></div><div class="ttdeci">const mtype * type</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00481">monster.h:481</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_a2f0829fa83c2c4d3007e26b91af11856"><div class="ttname"><a href="classoptional__vpart__position.html#a2f0829fa83c2c4d3007e26b91af11856">optional_vpart_position::part_with_feature</a></div><div class="ttdeci">cata::optional&lt; vpart_reference &gt; part_with_feature(const std::string &amp;f, bool unbroken) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02481">vehicle.cpp:2481</a></div></div>
<div class="ttc" id="aclassstring__id_html_ac180a60056901aaf79f5c4b728a257bd"><div class="ttname"><a href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">string_id::is_empty</a></div><div class="ttdeci">bool is_empty() const</div><div class="ttdoc">Returns whether this id is empty.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00298">string_id.h:298</a></div></div>
<div class="ttc" id="acreature_8h_html_a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31"><div class="ttname"><a href="creature_8h.html#a94151e401c177b20ea9b8bcadf74f592aaef7580aead8b8a18bc50cb6c1f98b31">MS_MEDIUM</a></div><div class="ttdeci">@ MS_MEDIUM</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00060">creature.h:60</a></div></div>
<div class="ttc" id="anamespaceunits_html_ada24d52c1ffd0df8d52a363d013d3231"><div class="ttname"><a href="namespaceunits.html#ada24d52c1ffd0df8d52a363d013d3231">units::from_kilojoule</a></div><div class="ttdeci">constexpr quantity&lt; value_type, energy_in_joule_tag &gt; from_kilojoule(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units__energy_8h_source.html#l00032">units_energy.h:32</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a1c359a305b979b2e5fc87d15db51e903"><div class="ttname"><a href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a></div><div class="ttdeci">static const itype_id itype_adv_UPS_off(&quot;adv_UPS_off&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a30c9d25adcf2167a8bff0fe6ca21fdaf"><div class="ttname"><a href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT</a></div><div class="ttdeci">static const std::string flag_RELOAD_AND_SHOOT(&quot;RELOAD_AND_SHOOT&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a55a80a9bbab1925d5462d46d355c2b6e"><div class="ttname"><a href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a></div><div class="ttdeci">static const itype_id itype_UPS(&quot;UPS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a9a327f2be95a30526c2d1ab6a31f72b2"><div class="ttname"><a href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN</a></div><div class="ttdeci">static const std::string flag_MOUNTED_GUN(&quot;MOUNTED_GUN&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_abca795246deac76d5cf0515c16bb75c8"><div class="ttname"><a href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE</a></div><div class="ttdeci">static const std::string flag_MOUNTABLE(&quot;MOUNTABLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ac48fadf8e0cc0bf9f6800029de9084d6"><div class="ttname"><a href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a></div><div class="ttdeci">static const bionic_id bio_ups(&quot;bio_ups&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ae89306fd36cf36b57fe05dad0db3f71b"><div class="ttname"><a href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a></div><div class="ttdeci">static const itype_id itype_UPS_off(&quot;UPS_off&quot;)</div></div>
<div class="ttc" id="astructmtype_html_abe1e1f1cacb0be37406c667e226003c4"><div class="ttname"><a href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mtype::mech_weapon</a></div><div class="ttdeci">itype_id mech_weapon</div><div class="ttdoc">If this monster is a rideable mech with built-in weapons, this is the weapons id.</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00368">mtype.h:368</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="item_8cpp_source.html#l07247">item::ammo_remaining()</a>, <a class="el" href="item_8cpp_source.html#l07317">item::ammo_required()</a>, <a class="el" href="item_8cpp_source.html#l07340">item::ammo_sufficient()</a>, <a class="el" href="ranged_8cpp.html#ac48fadf8e0cc0bf9f6800029de9084d6">bio_ups</a>, <a class="el" href="ranged_8cpp.html#abca795246deac76d5cf0515c16bb75c8">flag_MOUNTABLE()</a>, <a class="el" href="ranged_8cpp.html#a9a327f2be95a30526c2d1ab6a31f72b2">flag_MOUNTED_GUN()</a>, <a class="el" href="ranged_8cpp.html#a30c9d25adcf2167a8bff0fe6ca21fdaf">flag_RELOAD_AND_SHOOT()</a>, <a class="el" href="units__energy_8h_source.html#l00032">units::from_kilojoule()</a>, <a class="el" href="item_8cpp_source.html#l09780">item::get_gun_ups_drain()</a>, <a class="el" href="character_8cpp_source.html#l00387">get_player_character()</a>, <a class="el" href="character_8cpp_source.html#l01967">Character::get_power_level()</a>, <a class="el" href="character_8cpp_source.html#l00541">Character::get_size()</a>, <a class="el" href="character_8cpp_source.html#l01887">Character::has_active_bionic()</a>, <a class="el" href="character_8cpp_source.html#l09598">Character::has_charges()</a>, <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>, <a class="el" href="map_8cpp_source.html#l02320">map::has_flag_ter_or_furn()</a>, <a class="el" href="string__id_8h_source.html#l00298">string_id&lt; T &gt;::is_empty()</a>, <a class="el" href="character_8cpp_source.html#l01143">Character::is_mounted()</a>, <a class="el" href="ranged_8cpp.html#a1c359a305b979b2e5fc87d15db51e903">itype_adv_UPS_off</a>, <a class="el" href="ranged_8cpp.html#a55a80a9bbab1925d5462d46d355c2b6e">itype_UPS</a>, <a class="el" href="ranged_8cpp.html#ae89306fd36cf36b57fe05dad0db3f71b">itype_UPS_off</a>, <a class="el" href="mtype_8h_source.html#l00368">mtype::mech_weapon</a>, <a class="el" href="character_8h_source.html#l01556">Character::mounted_creature</a>, <a class="el" href="creature_8h_source.html#l00060">MS_MEDIUM</a>, <a class="el" href="vehicle_8cpp_source.html#l02481">optional_vpart_position::part_with_feature()</a>, <a class="el" href="character_8cpp_source.html#l00714">Character::pos()</a>, <a class="el" href="string__formatter_8h_source.html#l00418">string_format()</a>, <a class="el" href="item_8cpp_source.html#l04465">item::tname()</a>, <a class="el" href="monster_8h_source.html#l00481">monster::type</a>, and <a class="el" href="map_8cpp_source.html#l01007">map::veh_at()</a>.</p>

<p class="reference">Referenced by <a class="el" href="avatar__action_8cpp_source.html#l00619">avatar_action::can_fire_weapon()</a>, and <a class="el" href="ranged_8cpp_source.html#l02747">target_ui::update_status()</a>.</p>

</div>
</div>
<a id="abf8b46e1f1dae2e7a3d4ff75b9495026" name="abf8b46e1f1dae2e7a3d4ff75b9495026"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf8b46e1f1dae2e7a3d4ff75b9495026">&#9670;&nbsp;</a></span>handle_gun_damage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ranged::handle_gun_damage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>shooter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if a gun misfires, jams, or has other problems, else returns false. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00589">589</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>{</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="comment">// Below item (maximum dirt possible) should be greater than or equal to dirt range in item_group.cpp. Also keep in mind that monster drops can have specific ranges and these should be below the max!</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> dirt_max_dbl = 10000;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <a class="code hl_define" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Tried to handle_gun_damage of a non-gun %s&quot;</span>, it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    }</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    <span class="keywordtype">int</span> dirt = it.<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <span class="keywordtype">int</span> dirtadder = 0;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="keywordtype">double</span> dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <span class="keywordflow">if</span>( it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    }</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span> </div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;curammo_effects = it.<a class="code hl_function" href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">ammo_effects</a>();</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structislot__gun.html">islot_gun</a> &amp;firing = *it.<a class="code hl_variable" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code hl_variable" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    <span class="comment">// misfire chance based on dirt accumulation. Formula is designed to make chance of jam highly unlikely at low dirt levels, but levels increase geometrically as the dirt level reaches max (10,000). The number used is just a figure I found reasonable after plugging the number into excel and changing it until the probability made sense at high, medium, and low levels of dirt.</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a> ) &amp;&amp;</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                1000000000000.0 ) ) {</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>            <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>            it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        <span class="comment">// at high dirt levels the chance to misfire gets to significant levels. 10,000 is max and 7800 is quite high so above that the player gets some relief in the form of exchanging time for some dirt reduction. Basically jiggling the parts loose to remove some dirt and get a few more shots out.</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        <span class="keywordflow">if</span>( dirt_dbl &gt;</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            7800 ) {</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>            shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of your %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>                <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of &lt;npcname&gt;&#39;s %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>                it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        }</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>    }</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="comment">// Here we check if we&#39;re underwater and whether we should misfire.</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <span class="comment">// As a result this causes no damage to the firearm, note that some guns are waterproof</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    <span class="comment">// and so are immune to this effect, note also that WATERPROOF_GUN status does not</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    <span class="comment">// mean the gun will actually be accurate underwater.</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="keywordtype">int</span> effective_durability = firing.<a class="code hl_variable" href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">durability</a>;</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <span class="keywordflow">if</span>( shooter.<a class="code hl_function" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <span class="stringliteral">&quot;WATERPROOF_GUN&quot;</span> ) &amp;&amp;</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( effective_durability ) ) {</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        <span class="comment">// Here we check for a chance for the weapon to suffer a mechanical malfunction.</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <span class="comment">// Note that some weapons never jam up &#39;NEVER_JAMS&#39; and thus are immune to this</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        <span class="comment">// effect as current guns have a durability between 5 and 9 this results in</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        <span class="comment">// a chance of mechanical failure between 1/(64*3) and 1/(1024*3) on any given shot.</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>        <span class="comment">// the malfunction can&#39;t cause damage</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( ( 2 &lt;&lt; effective_durability ) * 3 ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a> ) ) {</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s malfunctions!&quot;</span> ),</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s malfunctions!&quot;</span> ),</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="comment">// Here we check for a chance for the weapon to suffer a misfire due to</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="comment">// using player-made &#39;RECYCLED&#39; bullets. Note that not all forms of</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>        <span class="comment">// player-made ammunition have this effect.</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a> ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 256 ) ) {</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>        <span class="comment">// Here we check for a chance for attached mods to get damaged if they are flagged as &#39;CONSUMABLE&#39;.</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        <span class="comment">// This is mostly for crappy handmade expedient stuff  or things that rarely receive damage during normal usage.</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        <span class="comment">// Default chance is 1/10000 unless set via json, damage is proportional to caliber(see below).</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="comment">// Can be toned down with &#39;consume_divisor.&#39;</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span> </div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a> ) &amp;&amp; !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a> ) &amp;&amp;</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>               !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a> ) &amp;&amp; !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a> ) ) {</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>        <span class="keywordtype">int</span> uncork = ( ( 10 * it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;loudness )</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>                       + ( it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil / 2 ) ) / 100;</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>        uncork = std::pow( uncork, 3 ) * 6.5;</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>        <span class="keywordflow">for</span>( <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : it.<a class="code hl_function" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;has_flag( <a class="code hl_function" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a> ) ) {</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                <span class="keywordtype">int</span> dmgamt = uncork / <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_divisor;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                <span class="keywordtype">int</span> modconsume = <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_chance;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>                <span class="keywordtype">int</span> initstate = it.<a class="code hl_function" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>();</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>                <span class="comment">// fuzz damage if it&#39;s small</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                <span class="keywordflow">if</span>( dmgamt &lt; 1000 ) {</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>                    dmgamt = <a class="code hl_function" href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a>( dmgamt, dmgamt + 200 );</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>                    <span class="comment">// ignore damage if inconsequential.</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>                }</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>                <span class="keywordflow">if</span>( dmgamt &lt; 800 ) {</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>                    dmgamt = 0;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>                }</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>                <span class="keywordflow">if</span>( <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( modconsume ) ) {</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>                    <span class="keywordflow">if</span>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;mod_damage( dmgamt ) ) {</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>                        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your attached %s is destroyed by your shot!&quot;</span> ),</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>                                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s attached %s is destroyed by their shot!&quot;</span> ),</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>                                                       <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>                        shooter.<a class="code hl_function" href="classCharacter.html#a35f89e2e6eb1144b623be5281f4f221b">i_rem</a>( <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> );</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>() &gt; initstate ) {</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>                        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your attached %s is damaged by your shot!&quot;</span> ),</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>                                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by their shot!&quot;</span> ),</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>                                                       <a class="code hl_enumeration" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>                    }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>                }</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>            }</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        }</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>    }</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>    <span class="keywordflow">if</span>( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) &amp;&amp;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl, dirt_max_dbl ) ) {</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>        it.<a class="code hl_function" href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">inc_damage</a>();</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>    }</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    <span class="keywordflow">if</span>( ( ( !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a> ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a> ) ) ||</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>          ( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) ) ) &amp;&amp;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>        !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a> ) ) {</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>        <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ||</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>            it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) ) {</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>            <span class="keywordflow">if</span>( ( ( it.<a class="code hl_function" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code hl_variable" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil &lt; firing.<a class="code hl_variable" href="structislot__gun.html#a68eca15622f086d544820aabcb2a865a">min_cycle_recoil</a> ) ||</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                  ( it.<a class="code hl_function" href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">has_fault</a>( <a class="code hl_variable" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a> ) &amp;&amp; <a class="code hl_function" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 16 ) ) ) &amp;&amp;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                it.<a class="code hl_function" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>                                               <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>                                               it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                <span class="comment">// Don&#39;t return false in this case; this shot happens, follow-up ones won&#39;t.</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            }</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>        }</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>        <span class="comment">// These are the dirtying/fouling mechanics</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        <span class="keywordflow">if</span>( !curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a> ) &amp;&amp; !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a> ) ) {</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>            <span class="keywordflow">if</span>( dirt &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ) ) {</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>                dirtadder = curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) * ( 200 -</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>                            ( firing.<a class="code hl_variable" href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">blackpowder_tolerance</a> *</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>                              2 ) );</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>                <span class="comment">// dirtadder is the dirt-increasing number for shots fired with gunpowder-based ammo. Usually dirt level increases by 1, unless it&#39;s blackpowder, in which case it increases by a higher number, but there is a reduction for blackpowder resistance of a weapon.</span></div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>                <span class="keywordflow">if</span>( dirtadder &lt; 0 ) {</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>                    dirtadder = 0;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>                }</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>                <span class="comment">// in addition to increasing dirt level faster, regular gunpowder fouling is also capped at 7,150, not 10,000. So firing with regular gunpowder can never make the gun quite as bad as firing it with black gunpowder. At 7,150 the chance to jam is significantly lower (though still significant) than it is at 10,000, the absolute cap.</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>                <span class="keywordflow">if</span>( curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ||</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>                    dirt &lt; 7150 ) {</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>                    it.<a class="code hl_function" href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">set_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, std::min( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ), dirt + dirtadder + 1 ) );</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>                }</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>            }</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>            dirt = it.<a class="code hl_function" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>            dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; !it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.count( <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> ) ) {</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>            }</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; curammo_effects.count( <a class="code hl_variable" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a> ) ) {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.erase( <a class="code hl_variable" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>                it.<a class="code hl_variable" href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">faults</a>.insert( <a class="code hl_variable" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> );</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>            }</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>            <span class="comment">// end fouling mechanics</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        }</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>    }</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>    <span class="comment">// chance to damage gun due to high levels of dirt. Very unlikely, especially at lower levels and impossible below 5,000. Lower than the chance of a jam at the same levels. 555555... is an arbitrary number that I came up with after playing with the formula in excel. It makes sense at low, medium, and high levels of dirt.</span></div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>    <span class="keywordflow">if</span>( dirt_dbl &gt; 5000 &amp;&amp;</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        <a class="code hl_function" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>                5555555555555 ) ) {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        shooter.<a class="code hl_function" href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Your %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                                       <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                                       it.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <span class="comment">// Don&#39;t increment until after the message</span></div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        it.<a class="code hl_function" href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">inc_damage</a>();</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>    }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>}</div>
<div class="ttc" id="aartifact_8cpp_html_a70800e95389f34dd34186fafaea2a840"><div class="ttname"><a href="artifact_8cpp.html#a70800e95389f34dd34186fafaea2a840">rng</a></div><div class="ttdeci">units::quantity&lt; V, B &gt; rng(const units::quantity&lt; V, B &gt; &amp;min, const units::quantity&lt; V, B &gt; &amp;max)</div><div class="ttdef"><b>Definition:</b> <a href="artifact_8cpp_source.html#l00032">artifact.cpp:32</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_a359120c15f92d54a49fec9de7bcb571f"><div class="ttname"><a href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a></div><div class="ttdeci">bool x_in_y(const time_duration &amp;a, const time_duration &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00521">calendar.cpp:521</a></div></div>
<div class="ttc" id="aclassCharacter_html_a35f89e2e6eb1144b623be5281f4f221b"><div class="ttname"><a href="classCharacter.html#a35f89e2e6eb1144b623be5281f4f221b">Character::i_rem</a></div><div class="ttdeci">item i_rem(int pos)</div><div class="ttdoc">Remove a specific item from player possession.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02424">character.cpp:2424</a></div></div>
<div class="ttc" id="aclassCreature_html_a5a2346f549de9c87e8f2afeec1e71366"><div class="ttname"><a href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">Creature::is_underwater</a></div><div class="ttdeci">virtual bool is_underwater() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00174">creature.cpp:174</a></div></div>
<div class="ttc" id="aclassCreature_html_a7cf71d2bd6c350f2ceda3f1d64046e63"><div class="ttname"><a href="classCreature.html#a7cf71d2bd6c350f2ceda3f1d64046e63">Creature::add_msg_player_or_npc</a></div><div class="ttdeci">virtual void add_msg_player_or_npc(const std::string &amp;, const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00677">creature.h:677</a></div></div>
<div class="ttc" id="aclassitem_html_a0b12108a604ac9d940716bb8f1368cf5"><div class="ttname"><a href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">item::get_var</a></div><div class="ttdeci">double get_var(const std::string &amp;name, double default_value) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01025">item.cpp:1025</a></div></div>
<div class="ttc" id="aclassitem_html_a12a6fa8aac1350f3ca4362a1bdccd9b0"><div class="ttname"><a href="classitem.html#a12a6fa8aac1350f3ca4362a1bdccd9b0">item::faults</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults</div><div class="ttdoc">What faults (if any) currently apply to this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02160">item.h:2160</a></div></div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06388">item.cpp:6388</a></div></div>
<div class="ttc" id="aclassitem_html_a45bcd33992b7d26eb4ae9f76a16b58fa"><div class="ttname"><a href="classitem.html#a45bcd33992b7d26eb4ae9f76a16b58fa">item::has_fault</a></div><div class="ttdeci">bool has_fault(const fault_id &amp;fault) const</div><div class="ttdoc">Does this item have the specified fault.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05203">item.cpp:5203</a></div></div>
<div class="ttc" id="aclassitem_html_a4938361b8fe897c4e85d66020ef91aff"><div class="ttname"><a href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">item::set_var</a></div><div class="ttdeci">void set_var(const std::string &amp;name, int value)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00995">item.cpp:995</a></div></div>
<div class="ttc" id="aclassitem_html_a4adcc4a3a5f5fb20a4d245d79109640a"><div class="ttname"><a href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">item::ammo_data</a></div><div class="ttdeci">const itype * ammo_data() const</div><div class="ttdoc">Specific ammo data, returns nullptr if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07397">item.cpp:7397</a></div></div>
<div class="ttc" id="aclassitem_html_a75fa277bb39c1d2922137986c67d48fb"><div class="ttname"><a href="classitem.html#a75fa277bb39c1d2922137986c67d48fb">item::ammo_effects</a></div><div class="ttdeci">std::set&lt; ammo_effect_str_id &gt; ammo_effects(bool with_ammo=true) const</div><div class="ttdoc">Get ammo effects for item optionally inclusive of any resulting from the loaded ammo.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07492">item.cpp:7492</a></div></div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02156">item.h:2156</a></div></div>
<div class="ttc" id="aclassitem_html_aca60af3c295738c2c1fddf0fd669f9a1"><div class="ttname"><a href="classitem.html#aca60af3c295738c2c1fddf0fd669f9a1">item::inc_damage</a></div><div class="ttdeci">bool inc_damage(damage_type dt)</div><div class="ttdoc">Increment item damage by itype::damage_scale constrained by max_damage.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06124">item.cpp:6124</a></div></div>
<div class="ttc" id="aclassitem_html_acd78321ba4d5c09d39f1d58d20b68484"><div class="ttname"><a href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">item::gunmods</a></div><div class="ttdeci">std::vector&lt; item * &gt; gunmods()</div><div class="ttdoc">Returns all gunmods currently attached to this item (always empty if item not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07599">item.cpp:7599</a></div></div>
<div class="ttc" id="aclassitem_html_adaaa3ece39eb40637371659dad8550e3"><div class="ttname"><a href="classitem.html#adaaa3ece39eb40637371659dad8550e3">item::faults_potential</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults_potential() const</div><div class="ttdoc">What faults can potentially occur with this item?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06675">item.cpp:6675</a></div></div>
<div class="ttc" id="aclassitem_html_ae8a58c6fe3c80cded11d6f3ccfa548a3"><div class="ttname"><a href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">item::damage</a></div><div class="ttdeci">int damage() const</div><div class="ttdoc">How much damage has the item sustained?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00696">item.cpp:696</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level DL::Error and class DC::DebugMsg, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00074">debug.h:74</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a></div><div class="ttdeci">@ m_bad</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00254">enums.h:254</a></div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">enchant_vals::mod</a></div><div class="ttdeci">mod</div><div class="ttdef"><b>Definition:</b> <a href="magic__enchantment_8h_source.html#l00026">magic_enchantment.h:26</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a02a98acfc0759dc42a3683ec82f936a9"><div class="ttname"><a href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_EMP(&quot;EMP&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0ea533037e4a6a02394d39e2d62174bc"><div class="ttname"><a href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a></div><div class="ttdeci">static const fault_id fault_gun_dirt(&quot;fault_gun_dirt&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4823a8b924c5e1c83c8e1e1a316e1ae7"><div class="ttname"><a href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_LASER(&quot;LASER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a680b9ce8c9824607142f83b2260dd3ef"><div class="ttname"><a href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_BLACKPOWDER(&quot;BLACKPOWDER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6a67c1570499e9c4ab345a0c6f1ba026"><div class="ttname"><a href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a></div><div class="ttdeci">static const fault_id fault_gun_blackpowder(&quot;fault_gun_blackpowder&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a916c022e69240915ee6678d0170882d3"><div class="ttname"><a href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE</a></div><div class="ttdeci">static const std::string flag_CONSUMABLE(&quot;CONSUMABLE&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aa125c6da24f14c1bec090943b0174e58"><div class="ttname"><a href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING</a></div><div class="ttdeci">static const std::string flag_NON_FOULING(&quot;NON-FOULING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aaf09bb55e60a45b1eb81e989d0758e93"><div class="ttname"><a href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_PLASMA(&quot;PLASMA&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab2dd3d8bd3db68ab02a94d2d26d2fc5a"><div class="ttname"><a href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS</a></div><div class="ttdeci">static const std::string flag_NEVER_JAMS(&quot;NEVER_JAMS&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab97e95eba84f451228755a351c0476f7"><div class="ttname"><a href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_NON_FOULING(&quot;NON-FOULING&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ace607007c38b8d55a601963b24f89e7e"><div class="ttname"><a href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a></div><div class="ttdeci">static const fault_id fault_gun_chamber_spent(&quot;fault_gun_chamber_spent&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad23a05e76b668009068f0e453c33692b"><div class="ttname"><a href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON</a></div><div class="ttdeci">static const std::string flag_PRIMITIVE_RANGED_WEAPON(&quot;PRIMITIVE_RANGED_WEAPON&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad73ddd0cc91027278ca5627eaa4ef206"><div class="ttname"><a href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a></div><div class="ttdeci">static const fault_id fault_gun_unlubricated(&quot;fault_gun_unlubricated&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_afa18fa10e4bc2e18f3911cebb559b7bd"><div class="ttname"><a href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a></div><div class="ttdeci">static const ammo_effect_str_id ammo_effect_RECYCLED(&quot;RECYCLED&quot;)</div></div>
<div class="ttc" id="arng_8cpp_html_aad28bdad07401a34ecf9912708f8b750"><div class="ttname"><a href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a></div><div class="ttdeci">bool one_in(int chance)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00065">rng.cpp:65</a></div></div>
<div class="ttc" id="astructislot__gun_html"><div class="ttname"><a href="structislot__gun.html">islot_gun</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00459">itype.h:459</a></div></div>
<div class="ttc" id="astructislot__gun_html_a014b797e92e543ea47be93a1d6771a90"><div class="ttname"><a href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">islot_gun::blackpowder_tolerance</a></div><div class="ttdeci">int blackpowder_tolerance</div><div class="ttdoc">One in X chance for gun to require major cleanup after firing blackpowder shot.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00502">itype.h:502</a></div></div>
<div class="ttc" id="astructislot__gun_html_a40255e8d661dc99204ed70dbe6013a02"><div class="ttname"><a href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">islot_gun::durability</a></div><div class="ttdeci">int durability</div><div class="ttdoc">Gun durability, affects gun being damaged during shooting.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00471">itype.h:471</a></div></div>
<div class="ttc" id="astructislot__gun_html_a68eca15622f086d544820aabcb2a865a"><div class="ttname"><a href="structislot__gun.html#a68eca15622f086d544820aabcb2a865a">islot_gun::min_cycle_recoil</a></div><div class="ttdeci">int min_cycle_recoil</div><div class="ttdoc">Minimum ammo recoil for gun to be able to fire more than once per attack.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00506">itype.h:506</a></div></div>
<div class="ttc" id="astructitype_html_a623ec8243b1e599086fa3a23c3179370"><div class="ttname"><a href="structitype.html#a623ec8243b1e599086fa3a23c3179370">itype::gun</a></div><div class="ttdeci">cata::value_ptr&lt; islot_gun &gt; gun</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00859">itype.h:859</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00864">itype.h:864</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="creature_8h_source.html#l00677">Creature::add_msg_player_or_npc()</a>, <a class="el" href="itype_8h_source.html#l00864">itype::ammo</a>, <a class="el" href="item_8cpp_source.html#l07397">item::ammo_data()</a>, <a class="el" href="ranged_8cpp.html#a680b9ce8c9824607142f83b2260dd3ef">ammo_effect_BLACKPOWDER</a>, <a class="el" href="ranged_8cpp.html#a02a98acfc0759dc42a3683ec82f936a9">ammo_effect_EMP</a>, <a class="el" href="ranged_8cpp.html#a4823a8b924c5e1c83c8e1e1a316e1ae7">ammo_effect_LASER</a>, <a class="el" href="ranged_8cpp.html#ab97e95eba84f451228755a351c0476f7">ammo_effect_NON_FOULING</a>, <a class="el" href="ranged_8cpp.html#aaf09bb55e60a45b1eb81e989d0758e93">ammo_effect_PLASMA</a>, <a class="el" href="ranged_8cpp.html#afa18fa10e4bc2e18f3911cebb559b7bd">ammo_effect_RECYCLED</a>, <a class="el" href="item_8cpp_source.html#l07492">item::ammo_effects()</a>, <a class="el" href="itype_8h_source.html#l00502">islot_gun::blackpowder_tolerance</a>, <a class="el" href="item_8cpp_source.html#l00696">item::damage()</a>, <a class="el" href="debug_8h_source.html#l00074">debugmsg</a>, <a class="el" href="itype_8h_source.html#l00471">islot_gun::durability</a>, <a class="el" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a>, <a class="el" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a>, <a class="el" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a>, <a class="el" href="ranged_8cpp.html#ad73ddd0cc91027278ca5627eaa4ef206">fault_gun_unlubricated</a>, <a class="el" href="item_8h_source.html#l02160">item::faults</a>, <a class="el" href="item_8cpp_source.html#l06675">item::faults_potential()</a>, <a class="el" href="ranged_8cpp.html#a916c022e69240915ee6678d0170882d3">flag_CONSUMABLE()</a>, <a class="el" href="ranged_8cpp.html#ab2dd3d8bd3db68ab02a94d2d26d2fc5a">flag_NEVER_JAMS()</a>, <a class="el" href="ranged_8cpp.html#aa125c6da24f14c1bec090943b0174e58">flag_NON_FOULING()</a>, <a class="el" href="ranged_8cpp.html#ad23a05e76b668009068f0e453c33692b">flag_PRIMITIVE_RANGED_WEAPON()</a>, <a class="el" href="item_8cpp_source.html#l01025">item::get_var()</a>, <a class="el" href="itype_8h_source.html#l00859">itype::gun</a>, <a class="el" href="item_8cpp_source.html#l07599">item::gunmods()</a>, <a class="el" href="item_8cpp_source.html#l05203">item::has_fault()</a>, <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>, <a class="el" href="character_8cpp_source.html#l02424">Character::i_rem()</a>, <a class="el" href="item_8cpp_source.html#l06124">item::inc_damage()</a>, <a class="el" href="item_8cpp_source.html#l06388">item::is_gun()</a>, <a class="el" href="creature_8cpp_source.html#l00174">Creature::is_underwater()</a>, <a class="el" href="enums_8h_source.html#l00254">m_bad</a>, <a class="el" href="itype_8h_source.html#l00506">islot_gun::min_cycle_recoil</a>, <a class="el" href="rng_8cpp_source.html#l00065">one_in()</a>, <a class="el" href="artifact_8cpp_source.html#l00032">rng()</a>, <a class="el" href="item_8cpp_source.html#l00995">item::set_var()</a>, <a class="el" href="item_8cpp_source.html#l04465">item::tname()</a>, <a class="el" href="item_8h_source.html#l02156">item::type</a>, and <a class="el" href="calendar_8cpp_source.html#l00521">x_in_y()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00810">player::fire_gun()</a>.</p>

</div>
</div>
<a id="ad0ad7f6e4c593e68012655f0befed8cf" name="ad0ad7f6e4c593e68012655f0befed8cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0ad7f6e4c593e68012655f0befed8cf">&#9670;&nbsp;</a></span>hit_chance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double ranged::hit_chance </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classdispersion__sources.html">dispersion_sources</a> &amp;&#160;</td>
          <td class="paramname"><em>dispersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>target_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>missed_by</em> = <code>1.0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The chance that a fired shot reaches required accuracy - by default grazing shot. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dispersion</td><td>accuracy of the shot. Must be a purely normal distribution. </td></tr>
    <tr><td class="paramname">range</td><td>distance between the shooter and the target. </td></tr>
    <tr><td class="paramname">target_size</td><td>size of the target, in the range (0, 1]. </td></tr>
    <tr><td class="paramname">missed_by</td><td>maximum degree of miss, in the range (0, 1]. Effectively a multiplier on</td></tr>
    <tr><td class="paramname">target_size.</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ballistics_8cpp_source.html#l00514">514</a> of file <a class="el" href="ballistics_8cpp_source.html">ballistics.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>{</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="keywordflow">if</span>( range &lt;= 0 ) {</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    }</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span> </div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <span class="keywordtype">double</span> missed_by_tiles = missed_by * target_size;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span> </div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    <span class="comment">//          T = (2*D**2 * (1 - cos V)) ** 0.5   (from iso_tangent)</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">//      cos V = 1 - T**2 / (2*D**2)</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="keywordtype">double</span> cosV = 1 - missed_by_tiles * missed_by_tiles / ( 2 * range * range );</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    <span class="keywordtype">double</span> needed_dispersion = ( cosV &lt; -1.0 ? <a class="code hl_define" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> : acos( cosV ) ) * 180 * 60 / <a class="code hl_define" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="cata__utility_8cpp.html#aedad91155e8b8c3f459bd5c588b80dd0">normal_cdf</a>( needed_dispersion, dispersion.<a class="code hl_function" href="classdispersion__sources.html#acef366e9f542abaeaa4babeeee3b78e2">avg</a>(), dispersion.<a class="code hl_function" href="classdispersion__sources.html#acef366e9f542abaeaa4babeeee3b78e2">avg</a>() / 2 );</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>}</div>
<div class="ttc" id="acata__utility_8cpp_html_aedad91155e8b8c3f459bd5c588b80dd0"><div class="ttname"><a href="cata__utility_8cpp.html#aedad91155e8b8c3f459bd5c588b80dd0">normal_cdf</a></div><div class="ttdeci">double normal_cdf(double x, double mean, double stddev)</div><div class="ttdoc">Cumulative distribution function of a certain normal distribution.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00106">cata_utility.cpp:106</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_acef366e9f542abaeaa4babeeee3b78e2"><div class="ttname"><a href="classdispersion__sources.html#acef366e9f542abaeaa4babeeee3b78e2">dispersion_sources::avg</a></div><div class="ttdeci">double avg() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00035">dispersion.cpp:35</a></div></div>
<div class="ttc" id="amath__defines_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="math__defines_8h_source.html#l00021">math_defines.h:21</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="dispersion_8cpp_source.html#l00035">dispersion_sources::avg()</a>, <a class="el" href="math__defines_8h_source.html#l00021">M_PI</a>, and <a class="el" href="cata__utility_8cpp_source.html#l00106">normal_cdf()</a>.</p>

</div>
</div>
<a id="a51e6279a2008714e5596da4f5fa1b00e" name="a51e6279a2008714e5596da4f5fa1b00e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51e6279a2008714e5596da4f5fa1b00e">&#9670;&nbsp;</a></span>hit_with_aoe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a> ranged::hit_with_aoe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdamage__instance.html">damage_instance</a> &amp;&#160;</td>
          <td class="paramname"><em>di</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="creature_8cpp_source.html#l00615">615</a> of file <a class="el" href="creature_8cpp_source.html">creature.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>{</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a> = target.<a class="code hl_function" href="classCreature.html#ac4dbde454c86b3296f53681c60612974">get_body</a>();</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    <span class="keywordtype">float</span> hit_size_sum = std::accumulate( <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a>.begin(), <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a>.end(), 0.0f,</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    []( <span class="keywordtype">float</span> acc, <span class="keyword">const</span> std::pair&lt;bodypart_str_id, bodypart&gt; &amp;pr ) {</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>        return acc + pr.first-&gt;hit_size;</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    } );</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <a class="code hl_struct" href="structdealt__damage__instance.html">dealt_damage_instance</a> dealt_damage;</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const bodypart_str_id, bodypart&gt; &amp;pr : <a class="code hl_variable" href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a> ) {</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        <a class="code hl_struct" href="structdamage__instance.html">damage_instance</a> impact = di;</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>        impact.<a class="code hl_function" href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">mult_damage</a>( pr.first-&gt;hit_size / hit_size_sum );</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>        <a class="code hl_struct" href="structdealt__damage__instance.html">dealt_damage_instance</a> bp_damage = target.<a class="code hl_function" href="classCreature.html#a75ad96eb6ce27d3c1df250965b4de7b5">deal_damage</a>( source, pr.first.id(), impact );</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; dealt_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>.size(); i++ ) {</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>            dealt_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>[i] += bp_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_dams</a>[i];</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        }</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    dealt_damage.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> = <a class="code hl_function" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">bodypart_str_id::NULL_ID</a>()-&gt;<a class="code hl_variable" href="structbody__part__type.html#a90beb41f3dca18cdbe06f8483336c899">token</a>;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="character_8cpp.html#a2fcb25d686f4a35fca374c6f71280311">get_player_character</a>().sees( target ) ) {</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <a class="code hl_function" href="namespaceranged.html#af042bc3e3b1ea1c57a42ee323ad284a8">ranged::print_dmg_msg</a>( target, source, dealt_damage );</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    }</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="keywordflow">if</span>( target.<a class="code hl_function" href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">has_effect</a>( <a class="code hl_variable" href="creature_8cpp.html#a7c7651a289cc19a34456c213eeb46edc">effect_ridden</a> ) ) {</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <a class="code hl_class" href="classmonster.html">monster</a> *mons = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classmonster.html">monster</a> *<span class="keyword">&gt;</span>( &amp;target );</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        <span class="keywordflow">if</span>( mons &amp;&amp; mons-&gt;<a class="code hl_variable" href="classmonster.html#aa07ebef40819868b9f7a86383d6cd8c3">mounted_player</a> &amp;&amp; !mons-&gt;<a class="code hl_function" href="classmonster.html#a0315651e596e69f0626b30e081726596">has_flag</a>( <a class="code hl_enumvalue" href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842af91c5e1f99c06d67e9def13a16cc8b72">MF_MECH_DEFENSIVE</a> ) ) {</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            <span class="comment">// TODO: Return value</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>            <a class="code hl_function" href="namespaceranged.html#a51e6279a2008714e5596da4f5fa1b00e">hit_with_aoe</a>( *mons-&gt;<a class="code hl_variable" href="classmonster.html#aa07ebef40819868b9f7a86383d6cd8c3">mounted_player</a>, source, di );</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        }</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    }</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span> </div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <span class="keywordflow">return</span> dealt_damage;</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>}</div>
<div class="ttc" id="abodypart_8h_html_a089a199d69623f528a3883672f0a084e"><div class="ttname"><a href="bodypart_8h.html#a089a199d69623f528a3883672f0a084e">all_body_parts</a></div><div class="ttdeci">constexpr std::array&lt; body_part, 12 &gt; all_body_parts</div><div class="ttdoc">Contains all valid body_part values in the order they are defined in.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00082">bodypart.h:82</a></div></div>
<div class="ttc" id="aclassCreature_html_a6fb79df9315dc2bed6f34d9a2e37da90"><div class="ttname"><a href="classCreature.html#a6fb79df9315dc2bed6f34d9a2e37da90">Creature::has_effect</a></div><div class="ttdeci">bool has_effect(const efftype_id &amp;eff_id, body_part bp=num_bp) const</div><div class="ttdoc">Check if creature has the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01179">creature.cpp:1179</a></div></div>
<div class="ttc" id="aclassCreature_html_a75ad96eb6ce27d3c1df250965b4de7b5"><div class="ttname"><a href="classCreature.html#a75ad96eb6ce27d3c1df250965b4de7b5">Creature::deal_damage</a></div><div class="ttdeci">virtual dealt_damage_instance deal_damage(Creature *source, bodypart_id bp, const damage_instance &amp;dam)</div><div class="ttdoc">Deals the damage via an attack.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00879">creature.cpp:879</a></div></div>
<div class="ttc" id="aclassCreature_html_ac4dbde454c86b3296f53681c60612974"><div class="ttname"><a href="classCreature.html#ac4dbde454c86b3296f53681c60612974">Creature::get_body</a></div><div class="ttdeci">const std::map&lt; bodypart_str_id, bodypart &gt; &amp; get_body() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01527">creature.cpp:1527</a></div></div>
<div class="ttc" id="aclassmonster_html_a0315651e596e69f0626b30e081726596"><div class="ttname"><a href="classmonster.html#a0315651e596e69f0626b30e081726596">monster::has_flag</a></div><div class="ttdeci">bool has_flag(m_flag f) const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l00889">monster.cpp:889</a></div></div>
<div class="ttc" id="aclassmonster_html_aa07ebef40819868b9f7a86383d6cd8c3"><div class="ttname"><a href="classmonster.html#aa07ebef40819868b9f7a86383d6cd8c3">monster::mounted_player</a></div><div class="ttdeci">Character * mounted_player</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00461">monster.h:461</a></div></div>
<div class="ttc" id="aclassstring__id_html_ae29dd8ed38d2b5eb443a65ad46f10b2d"><div class="ttname"><a href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">string_id&lt; body_part_type &gt;::NULL_ID</a></div><div class="ttdeci">static const string_id&lt; body_part_type &gt; &amp; NULL_ID()</div><div class="ttdoc">Returns a null id whose string_id&lt;T&gt;::is_null() must always return true.</div></div>
<div class="ttc" id="acreature_8cpp_html_a7c7651a289cc19a34456c213eeb46edc"><div class="ttname"><a href="creature_8cpp.html#a7c7651a289cc19a34456c213eeb46edc">effect_ridden</a></div><div class="ttdeci">static const efftype_id effect_ridden(&quot;ridden&quot;)</div></div>
<div class="ttc" id="amtype_8h_html_afa4c966d04d2ddb261a7cde725eca842af91c5e1f99c06d67e9def13a16cc8b72"><div class="ttname"><a href="mtype_8h.html#afa4c966d04d2ddb261a7cde725eca842af91c5e1f99c06d67e9def13a16cc8b72">MF_MECH_DEFENSIVE</a></div><div class="ttdeci">@ MF_MECH_DEFENSIVE</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00118">mtype.h:118</a></div></div>
<div class="ttc" id="anamespaceranged_html_af042bc3e3b1ea1c57a42ee323ad284a8"><div class="ttname"><a href="namespaceranged.html#af042bc3e3b1ea1c57a42ee323ad284a8">ranged::print_dmg_msg</a></div><div class="ttdeci">void print_dmg_msg(Creature &amp;target, Creature *source, const dealt_damage_instance &amp;dealt_dam, hit_tier ht)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00553">creature.cpp:553</a></div></div>
<div class="ttc" id="astructbody__part__type_html_a90beb41f3dca18cdbe06f8483336c899"><div class="ttname"><a href="structbody__part__type.html#a90beb41f3dca18cdbe06f8483336c899">body_part_type::token</a></div><div class="ttdeci">body_part token</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00106">bodypart.h:106</a></div></div>
<div class="ttc" id="astructdamage__instance_html"><div class="ttname"><a href="structdamage__instance.html">damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00051">damage.h:51</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a6cc673dba3d2de116c2579c3eda7ed23"><div class="ttname"><a href="structdamage__instance.html#a6cc673dba3d2de116c2579c3eda7ed23">damage_instance::mult_damage</a></div><div class="ttdeci">void mult_damage(double multiplier, bool pre_armor=false)</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00048">damage.cpp:48</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html"><div class="ttname"><a href="structdealt__damage__instance.html">dealt_damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00085">damage.h:85</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_a406b816a99913bd6a91b000cc7198a7c"><div class="ttname"><a href="structdealt__damage__instance.html#a406b816a99913bd6a91b000cc7198a7c">dealt_damage_instance::dealt_dams</a></div><div class="ttdeci">std::array&lt; int, NUM_DT &gt; dealt_dams</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00086">damage.h:86</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_ad39dc827923ad7b203f2061134ed1db1"><div class="ttname"><a href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">dealt_damage_instance::bp_hit</a></div><div class="ttdeci">body_part bp_hit</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00087">damage.h:87</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00082">all_body_parts</a>, <a class="el" href="damage_8h_source.html#l00087">dealt_damage_instance::bp_hit</a>, <a class="el" href="creature_8cpp_source.html#l00879">Creature::deal_damage()</a>, <a class="el" href="damage_8h_source.html#l00086">dealt_damage_instance::dealt_dams</a>, <a class="el" href="creature_8cpp.html#a7c7651a289cc19a34456c213eeb46edc">effect_ridden</a>, <a class="el" href="creature_8cpp_source.html#l01527">Creature::get_body()</a>, <a class="el" href="character_8cpp_source.html#l00387">get_player_character()</a>, <a class="el" href="creature_8cpp_source.html#l01179">Creature::has_effect()</a>, <a class="el" href="damage_8cpp_source.html#l00048">damage_instance::mult_damage()</a>, <a class="el" href="classstring__id.html#ae29dd8ed38d2b5eb443a65ad46f10b2d">string_id&lt; body_part_type &gt;::NULL_ID()</a>, <a class="el" href="creature_8cpp_source.html#l00553">print_dmg_msg()</a>, and <a class="el" href="bodypart_8h_source.html#l00106">body_part_type::token</a>.</p>

<p class="reference">Referenced by <a class="el" href="creature_8cpp_source.html#l01926">monster::add_msg_if_npc()</a>, and <a class="el" href="ranged__aoe_8cpp_source.html#l00044">execute_shaped_attack()</a>.</p>

</div>
</div>
<a id="af042bc3e3b1ea1c57a42ee323ad284a8" name="af042bc3e3b1ea1c57a42ee323ad284a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af042bc3e3b1ea1c57a42ee323ad284a8">&#9670;&nbsp;</a></span>print_dmg_msg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::print_dmg_msg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> &amp;&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> *&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structdealt__damage__instance.html">dealt_damage_instance</a> &amp;&#160;</td>
          <td class="paramname"><em>dealt_dam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53">hit_tier</a>&#160;</td>
          <td class="paramname"><em>ht</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="creature_8cpp_source.html#l00553">553</a> of file <a class="el" href="creature_8cpp_source.html">creature.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>{</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    std::string <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a>;</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <a class="code hl_enumeration" href="enums_8h.html#a3baf36d700701401b6baf94db93d096e">game_message_type</a> sct_color = <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a>;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="keywordflow">switch</span>( ht ) {</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="keywordflow">case</span> hit_tier::grazing:</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Grazing hit.&quot;</span> );</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>            sct_color = <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea379f06a1968886ca7a96b103d5a628fc">m_grazing</a>;</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <span class="keywordflow">case</span> hit_tier::normal:</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="keywordflow">case</span> hit_tier::critical:</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>            <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a> = <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Critical!&quot;</span> );</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>            sct_color = <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea8663170a60ff438f4ba2ab98a1e6d6b5">m_critical</a>;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    }</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span> </div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>    <span class="keywordflow">if</span>( source != <span class="keyword">nullptr</span> &amp;&amp; !<a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a>.empty() ) {</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        source-&gt;<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a> );</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    }</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="keywordflow">if</span>( dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() == 0 ) {</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>        <span class="comment">//~ 1$ - monster name, 2$ - character&#39;s bodypart or monster&#39;s skin/armor</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;The shot reflects off %1$s %2$s!&quot;</span> ), target.<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>( <span class="keyword">true</span> ),</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>                 ( target.<a class="code hl_function" href="classCreature.html#a07012d6d1998068bef112510c7424374">is_monster</a>() || dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> == <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ac09d37dac773806a42c13041ba254700">num_bp</a> ) ?</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                 target.<a class="code hl_function" href="classCreature.html#a490503cd007e206dcd23fd8457017793">skin_name</a>() :</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>                 <a class="code hl_function" href="bodypart_8cpp.html#ab29c0bad9828b787ace4d04a5e951c6b">body_part_name_accusative</a>( dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> ) );</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( target.<a class="code hl_function" href="classCreature.html#a1217a190a2e561227e831a72d4a6d390">is_player</a>() ) {</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>        <span class="comment">//monster hits player ranged</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>        <span class="comment">//~ Hit message. 1$s is bodypart name in accusative. 2$d is damage value.</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        target.<a class="code hl_function" href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You were hit in the %1$s for %2$d damage.&quot;</span> ),</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                                  <a class="code hl_function" href="bodypart_8cpp.html#ab29c0bad9828b787ace4d04a5e951c6b">body_part_name_accusative</a>( dealt_dam.<a class="code hl_variable" href="structdealt__damage__instance.html#ad39dc827923ad7b203f2061134ed1db1">bp_hit</a> ),</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>                                  dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() );</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( source != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>        <span class="keywordflow">if</span>( source-&gt;<a class="code hl_function" href="classCreature.html#a1217a190a2e561227e831a72d4a6d390">is_player</a>() ) {</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            <span class="comment">//player hits monster ranged</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            <a class="code hl_variable" href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a>.<a class="code hl_function" href="classscrollingcombattext.html#a10f4b620dcf4c99fe55d267fc2323723">add</a>( target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(),</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>                     <a class="code hl_function" href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a>( <a class="code hl_variable" href="point_8h.html#a0ee2195dcb488ae55fbf4316f5011172">point_zero</a>, target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() - source-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() ),</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>                     <a class="code hl_function" href="output_8cpp.html#a4fce254b5cc5c01524772be29ea40980">get_hp_bar</a>( dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>(), target.<a class="code hl_function" href="classCreature.html#a6e1819fd37a50af66566c6d1b896572a">get_hp_max</a>(), <span class="keyword">true</span> ).first,</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                     <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_variable" href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">message</a>, sct_color );</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span> </div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            <span class="keywordflow">if</span>( target.<a class="code hl_function" href="classCreature.html#a94737d93f30cee269b2df71478ee29fd">get_hp</a>() &gt; 0 ) {</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>                <a class="code hl_variable" href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a>.<a class="code hl_function" href="classscrollingcombattext.html#a10f4b620dcf4c99fe55d267fc2323723">add</a>( target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(),</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>                         <a class="code hl_function" href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a>( <a class="code hl_variable" href="point_8h.html#a0ee2195dcb488ae55fbf4316f5011172">point_zero</a>, target.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() - source-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>().<a class="code hl_function" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() ),</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>                         <a class="code hl_function" href="output_8cpp.html#a4fce254b5cc5c01524772be29ea40980">get_hp_bar</a>( target.<a class="code hl_function" href="classCreature.html#a94737d93f30cee269b2df71478ee29fd">get_hp</a>(), target.<a class="code hl_function" href="classCreature.html#a6e1819fd37a50af66566c6d1b896572a">get_hp_max</a>(), <span class="keyword">true</span> ).first, <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>,</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>                         <span class="comment">//~ &quot;hit points&quot;, used in scrolling combat text</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>                         <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;hp&quot;</span> ), <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a>, <span class="stringliteral">&quot;hp&quot;</span> );</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>                <a class="code hl_variable" href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a>.<a class="code hl_function" href="classscrollingcombattext.html#a94b652fa370f1b1a946c726c93abb9bd">removeCreatureHP</a>();</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>            }</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            <span class="comment">//~ %1$s: creature name, %2$d: damage value</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_enumvalue" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You hit %1$s for %2$d damage.&quot;</span> ),</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>                     target.<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>(), dealt_dam.<a class="code hl_function" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>() );</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>            <span class="comment">//~ 1$ - shooter, 2$ - target</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>            <a class="code hl_function" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;%1$s shoots %2$s.&quot;</span> ),</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>                     source-&gt;<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>(), target.<a class="code hl_function" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>() );</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        }</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    }</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>}</div>
<div class="ttc" id="abodypart_8cpp_html_ab29c0bad9828b787ace4d04a5e951c6b"><div class="ttname"><a href="bodypart_8cpp.html#ab29c0bad9828b787ace4d04a5e951c6b">body_part_name_accusative</a></div><div class="ttdeci">std::string body_part_name_accusative(body_part bp, int number)</div><div class="ttdoc">Returns the matching accusative name of the body_part token, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8cpp_source.html#l00329">bodypart.cpp:329</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ac09d37dac773806a42c13041ba254700"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ac09d37dac773806a42c13041ba254700">num_bp</a></div><div class="ttdeci">@ num_bp</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00053">bodypart.h:52</a></div></div>
<div class="ttc" id="aclassCreature_html_a07012d6d1998068bef112510c7424374"><div class="ttname"><a href="classCreature.html#a07012d6d1998068bef112510c7424374">Creature::is_monster</a></div><div class="ttdeci">virtual bool is_monster() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00101">creature.h:101</a></div></div>
<div class="ttc" id="aclassCreature_html_a1217a190a2e561227e831a72d4a6d390"><div class="ttname"><a href="classCreature.html#a1217a190a2e561227e831a72d4a6d390">Creature::is_player</a></div><div class="ttdeci">virtual bool is_player() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00092">creature.h:92</a></div></div>
<div class="ttc" id="aclassCreature_html_a26b7c431f85f0b99b888db69318ebdc5"><div class="ttname"><a href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">Creature::disp_name</a></div><div class="ttdeci">virtual std::string disp_name(bool possessive=false, bool capitalize_first=false) const =0</div></div>
<div class="ttc" id="aclassCreature_html_a45926a7ba63ccc9be744f87a4d540b7d"><div class="ttname"><a href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos</a></div><div class="ttdeci">virtual const tripoint &amp; pos() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a490503cd007e206dcd23fd8457017793"><div class="ttname"><a href="classCreature.html#a490503cd007e206dcd23fd8457017793">Creature::skin_name</a></div><div class="ttdeci">virtual std::string skin_name() const =0</div></div>
<div class="ttc" id="aclassCreature_html_a6e1819fd37a50af66566c6d1b896572a"><div class="ttname"><a href="classCreature.html#a6e1819fd37a50af66566c6d1b896572a">Creature::get_hp_max</a></div><div class="ttdeci">virtual int get_hp_max(const bodypart_id &amp;bp) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01657">creature.cpp:1657</a></div></div>
<div class="ttc" id="aclassCreature_html_a91dc4715c36eef7d116f944be9a4d435"><div class="ttname"><a href="classCreature.html#a91dc4715c36eef7d116f944be9a4d435">Creature::add_msg_if_player</a></div><div class="ttdeci">virtual void add_msg_if_player(const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00593">creature.h:593</a></div></div>
<div class="ttc" id="aclassCreature_html_a94737d93f30cee269b2df71478ee29fd"><div class="ttname"><a href="classCreature.html#a94737d93f30cee269b2df71478ee29fd">Creature::get_hp</a></div><div class="ttdeci">virtual int get_hp(const bodypart_id &amp;bp) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01640">creature.cpp:1640</a></div></div>
<div class="ttc" id="aclassscrollingcombattext_html_a10f4b620dcf4c99fe55d267fc2323723"><div class="ttname"><a href="classscrollingcombattext.html#a10f4b620dcf4c99fe55d267fc2323723">scrollingcombattext::add</a></div><div class="ttdeci">void add(const point &amp;pos, direction p_oDir, const std::string &amp;p_sText, game_message_type p_gmt, const std::string &amp;p_sText2=&quot;&quot;, game_message_type p_gmt2=m_neutral, const std::string &amp;p_sType=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01757">output.cpp:1757</a></div></div>
<div class="ttc" id="aclassscrollingcombattext_html_a94b652fa370f1b1a946c726c93abb9bd"><div class="ttname"><a href="classscrollingcombattext.html#a94b652fa370f1b1a946c726c93abb9bd">scrollingcombattext::removeCreatureHP</a></div><div class="ttdeci">void removeCreatureHP()</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01937">output.cpp:1937</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a00be0762df7b46da965e55caffac53db"><div class="ttname"><a href="coordinates_8h.html#a00be0762df7b46da965e55caffac53db">direction_from</a></div><div class="ttdeci">direction direction_from(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00540">coordinates.h:540</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096e"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096e">game_message_type</a></div><div class="ttdeci">game_message_type</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00252">enums.h:252</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a></div><div class="ttdeci">@ m_good</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00253">enums.h:253</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea379f06a1968886ca7a96b103d5a628fc"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea379f06a1968886ca7a96b103d5a628fc">m_grazing</a></div><div class="ttdeci">@ m_grazing</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00268">enums.h:268</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a></div><div class="ttdeci">@ m_neutral</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00260">enums.h:260</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea8663170a60ff438f4ba2ab98a1e6d6b5"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea8663170a60ff438f4ba2ab98a1e6d6b5">m_critical</a></div><div class="ttdeci">@ m_critical</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00267">enums.h:267</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00884">messages.cpp:884</a></div></div>
<div class="ttc" id="anamespacemapgen__defer_html_a616ad2c7ee2eb002b683b41b04a888c1"><div class="ttname"><a href="namespacemapgen__defer.html#a616ad2c7ee2eb002b683b41b04a888c1">mapgen_defer::message</a></div><div class="ttdeci">std::string message</div><div class="ttdef"><b>Definition:</b> <a href="mapgen_8cpp_source.html#l00403">mapgen.cpp:403</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a4fce254b5cc5c01524772be29ea40980"><div class="ttname"><a href="output_8cpp.html#a4fce254b5cc5c01524772be29ea40980">get_hp_bar</a></div><div class="ttdeci">std::pair&lt; std::string, nc_color &gt; get_hp_bar(const int cur_hp, const int max_hp, const bool is_mon)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l01604">output.cpp:1604</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ac8f1d6275ee49732d8988e5e671b1776"><div class="ttname"><a href="output_8cpp.html#ac8f1d6275ee49732d8988e5e671b1776">SCT</a></div><div class="ttdeci">scrollingcombattext SCT</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00065">output.cpp:65</a></div></div>
<div class="ttc" id="apoint_8h_html_a0ee2195dcb488ae55fbf4316f5011172"><div class="ttname"><a href="point_8h.html#a0ee2195dcb488ae55fbf4316f5011172">point_zero</a></div><div class="ttdeci">static constexpr point point_zero</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00274">point.h:274</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_a86b702070a1c313624abc78ff34eff48"><div class="ttname"><a href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">dealt_damage_instance::total_damage</a></div><div class="ttdeci">int total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00180">damage.cpp:180</a></div></div>
<div class="ttc" id="astructtripoint_html_accc0725c936dbebb2486f969f39e2e5f"><div class="ttname"><a href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">tripoint::xy</a></div><div class="ttdeci">constexpr point xy() const</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00220">point.h:220</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="output_8cpp_source.html#l01757">scrollingcombattext::add()</a>, <a class="el" href="messages_8cpp_source.html#l00884">add_msg()</a>, <a class="el" href="creature_8h_source.html#l00593">Creature::add_msg_if_player()</a>, <a class="el" href="bodypart_8cpp_source.html#l00329">body_part_name_accusative()</a>, <a class="el" href="damage_8h_source.html#l00087">dealt_damage_instance::bp_hit</a>, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a7e85bcb66fb9a809d5ab4f62a8b8bea8">critical</a>, <a class="el" href="coordinates_8h_source.html#l00540">direction_from()</a>, <a class="el" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">Creature::disp_name()</a>, <a class="el" href="creature_8cpp_source.html#l01640">Creature::get_hp()</a>, <a class="el" href="output_8cpp_source.html#l01604">get_hp_bar()</a>, <a class="el" href="creature_8cpp_source.html#l01657">Creature::get_hp_max()</a>, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53a52b0f37c2ac81918f900f3d3e6c98597">grazing</a>, <a class="el" href="creature_8h_source.html#l00101">Creature::is_monster()</a>, <a class="el" href="creature_8h_source.html#l00092">Creature::is_player()</a>, <a class="el" href="enums_8h_source.html#l00254">m_bad</a>, <a class="el" href="enums_8h_source.html#l00267">m_critical</a>, <a class="el" href="enums_8h_source.html#l00253">m_good</a>, <a class="el" href="enums_8h_source.html#l00268">m_grazing</a>, <a class="el" href="enums_8h_source.html#l00260">m_neutral</a>, <a class="el" href="mapgen_8cpp_source.html#l00403">mapgen_defer::message</a>, <a class="el" href="namespaceranged.html#a5d9da06327706ab87ae19ee9dc08de53afea087517c26fadd409bd4b9dc642555">normal</a>, <a class="el" href="bodypart_8h_source.html#l00052">num_bp</a>, <a class="el" href="point_8h_source.html#l00274">point_zero</a>, <a class="el" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos()</a>, <a class="el" href="output_8cpp_source.html#l01937">scrollingcombattext::removeCreatureHP()</a>, <a class="el" href="output_8cpp_source.html#l00065">SCT</a>, <a class="el" href="classCreature.html#a490503cd007e206dcd23fd8457017793">Creature::skin_name()</a>, <a class="el" href="damage_8cpp_source.html#l00180">dealt_damage_instance::total_damage()</a>, and <a class="el" href="point_8h_source.html#l00220">tripoint::xy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="creature_8cpp_source.html#l00615">hit_with_aoe()</a>.</p>

</div>
</div>
<a id="ae7778ea8feb8352ac65fe74e81164ebc" name="ae7778ea8feb8352ac65fe74e81164ebc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7778ea8feb8352ac65fe74e81164ebc">&#9670;&nbsp;</a></span>prompt_select_default_ammo_for()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ranged::prompt_select_default_ammo_for </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classavatar.html">avatar</a> &amp;&#160;</td>
          <td class="paramname"><em>u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prompts to select default ammo compatible with provided gun. </p>

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l03754">3754</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l03755" name="l03755"></a><span class="lineno"> 3755</span>{</div>
<div class="line"><a id="l03756" name="l03756"></a><span class="lineno"> 3756</span>    <a class="code hl_class" href="classitem_1_1reload__option.html">item::reload_option</a> opt = u.<a class="code hl_function" href="classplayer.html#a43a0479640831a4268c76fa19bbd1051">select_ammo</a>( w, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a id="l03757" name="l03757"></a><span class="lineno"> 3757</span>    <span class="keywordflow">if</span>( opt ) {</div>
<div class="line"><a id="l03758" name="l03758"></a><span class="lineno"> 3758</span>        <span class="keywordflow">if</span>( u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> &amp;&amp; opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a> == u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> ) {</div>
<div class="line"><a id="l03759" name="l03759"></a><span class="lineno"> 3759</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Cleared ammo preferences for %s.&quot;</span> ), w.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03760" name="l03760"></a><span class="lineno"> 3760</span>            u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> = <a class="code hl_class" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a id="l03761" name="l03761"></a><span class="lineno"> 3761</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( u.<a class="code hl_function" href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">has_item</a>( *opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a> ) ) {</div>
<div class="line"><a id="l03762" name="l03762"></a><span class="lineno"> 3762</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;Selected %s as default ammo for %s.&quot;</span> ), opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>-&gt;<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>(), w.<a class="code hl_function" href="classitem.html#a7e78e26dcf9b357cda769c3ca2938eda">tname</a>() );</div>
<div class="line"><a id="l03763" name="l03763"></a><span class="lineno"> 3763</span>            u.<a class="code hl_variable" href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">ammo_location</a> = opt.<a class="code hl_variable" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>;</div>
<div class="line"><a id="l03764" name="l03764"></a><span class="lineno"> 3764</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l03765" name="l03765"></a><span class="lineno"> 3765</span>            u.<a class="code hl_function" href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">add_msg_if_player</a>( <a class="code hl_define" href="translations_8h.html#aa829053017e23ef22d44dccecba63a34">_</a>( <span class="stringliteral">&quot;You don&#39;t have that ammo on you.&quot;</span> ) );</div>
<div class="line"><a id="l03766" name="l03766"></a><span class="lineno"> 3766</span>        }</div>
<div class="line"><a id="l03767" name="l03767"></a><span class="lineno"> 3767</span>    }</div>
<div class="line"><a id="l03768" name="l03768"></a><span class="lineno"> 3768</span>}</div>
<div class="ttc" id="aclassitem_1_1reload__option_html"><div class="ttname"><a href="classitem_1_1reload__option.html">item::reload_option</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00470">item.h:471</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html_afec3eb8ab3dff71940912db4a84ae7ea"><div class="ttname"><a href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">item::reload_option::ammo</a></div><div class="ttdeci">item_location ammo</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00483">item.h:483</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00022">item_location.h:23</a></div></div>
<div class="ttc" id="aclassplayer_html_a43a0479640831a4268c76fa19bbd1051"><div class="ttname"><a href="classplayer.html#a43a0479640831a4268c76fa19bbd1051">player::select_ammo</a></div><div class="ttdeci">item::reload_option select_ammo(const item &amp;base, bool prompt=false, bool include_empty_mags=true, bool include_potential=false) const</div><div class="ttdoc">Select suitable ammo with which to reload the item.</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l02285">player.cpp:2285</a></div></div>
<div class="ttc" id="aclassplayer_html_a5f1ee4ce958fda62c4766dd8762529c2"><div class="ttname"><a href="classplayer.html#a5f1ee4ce958fda62c4766dd8762529c2">player::ammo_location</a></div><div class="ttdeci">item_location ammo_location</div><div class="ttdef"><b>Definition:</b> <a href="player_8h_source.html#l00598">player.h:598</a></div></div>
<div class="ttc" id="aclassplayer_html_ae7009d849f19a4f5ebe877cbe463c459"><div class="ttname"><a href="classplayer.html#ae7009d849f19a4f5ebe877cbe463c459">player::add_msg_if_player</a></div><div class="ttdeci">void add_msg_if_player(const std::string &amp;msg) const override</div><div class="ttdef"><b>Definition:</b> <a href="player_8cpp_source.html#l03973">player.cpp:3973</a></div></div>
<div class="ttc" id="aclassvisitable_html_af49d5ef7b3f2f0a8664c23097a56373f"><div class="ttname"><a href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">visitable::has_item</a></div><div class="ttdeci">bool has_item(const item &amp;it) const</div><div class="ttdoc">Returns true if this visitable instance contains the item.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00095">visitable.cpp:95</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="translations_8h_source.html#l00116">_</a>, <a class="el" href="player_8cpp_source.html#l03973">player::add_msg_if_player()</a>, <a class="el" href="item_8h_source.html#l00483">item::reload_option::ammo</a>, <a class="el" href="player_8h_source.html#l00598">player::ammo_location</a>, <a class="el" href="visitable_8cpp_source.html#l00095">visitable&lt; T &gt;::has_item()</a>, <a class="el" href="player_8cpp_source.html#l02285">player::select_ammo()</a>, and <a class="el" href="item_8cpp_source.html#l04465">item::tname()</a>.</p>

<p class="reference">Referenced by <a class="el" href="handle__action_8cpp_source.html#l01514">game::handle_action()</a>, and <a class="el" href="avatar__action_8cpp_source.html#l01144">avatar_action::reload()</a>.</p>

</div>
</div>
<a id="a32d7ead84f4eb01b4050fdbbca0767ea" name="a32d7ead84f4eb01b4050fdbbca0767ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32d7ead84f4eb01b4050fdbbca0767ea">&#9670;&nbsp;</a></span>str_draw_damage_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::str_draw_damage_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01008">1008</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>{</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    }</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 1.0f ) {</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        <span class="keywordflow">return</span> 0.75f;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    }</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l09892">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04064">Character::get_str()</a>, <a class="el" href="ranged_8cpp_source.html#l00996">get_str_draw_penalty()</a>, and <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l00810">player::fire_gun()</a>, and <a class="el" href="item_8cpp_source.html#l01976">item::gun_info()</a>.</p>

</div>
</div>
<a id="a613a2847b3c06998d6117f2630fc9ed5" name="a613a2847b3c06998d6117f2630fc9ed5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a613a2847b3c06998d6117f2630fc9ed5">&#9670;&nbsp;</a></span>str_draw_dispersion_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::str_draw_dispersion_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01022">1022</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>{</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    }</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    }</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l09892">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04064">Character::get_str()</a>, <a class="el" href="ranged_8cpp_source.html#l00996">get_str_draw_penalty()</a>, and <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01883">player::get_weapon_dispersion()</a>.</p>

</div>
</div>
<a id="aa7a46e309ff8892e692a92511635a4eb" name="aa7a46e309ff8892e692a92511635a4eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7a46e309ff8892e692a92511635a4eb">&#9670;&nbsp;</a></span>str_draw_range_modifier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float ranged::str_draw_range_modifier </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>p</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01034">1034</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>{</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="keywordflow">if</span>( !it.<a class="code hl_function" href="classitem.html#aaa5aeb6f838927babb10ede535cf2a73">has_flag</a>( <a class="code hl_function" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW</a> ) || p.<a class="code hl_function" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() &gt;= it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() || it.<a class="code hl_function" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() &lt;= 1 ) {</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    }</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 0.75f ) {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code hl_function" href="namespaceranged.html#a4c8c85e0249f67213d9994612315aa3e">ranged::get_str_draw_penalty</a>( it, p ) &lt; 1.0f ) {</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <span class="keywordflow">return</span> 0.75f;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    }</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ranged_8cpp.html#a3756f1dde5d862fe1b0f0240dfc13e6a">flag_STR_DRAW()</a>, <a class="el" href="item_8cpp_source.html#l09892">item::get_min_str()</a>, <a class="el" href="character_8cpp_source.html#l04064">Character::get_str()</a>, <a class="el" href="ranged_8cpp_source.html#l00996">get_str_draw_penalty()</a>, and <a class="el" href="item_8cpp_source.html#l05213">item::has_flag()</a>.</p>

<p class="reference">Referenced by <a class="el" href="item_8cpp_source.html#l07222">item::gun_range()</a>.</p>

</div>
</div>
<a id="a3fc846128cfc30100d71fbb6e2d482c5" name="a3fc846128cfc30100d71fbb6e2d482c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fc846128cfc30100d71fbb6e2d482c5">&#9670;&nbsp;</a></span>targetable_creatures() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt; ranged::targetable_creatures </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>range</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02070">2070</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>{</div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af">targetable_creatures</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, range, <a class="code hl_class" href="classturret__data.html">turret_data</a>() );</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>}</div>
<div class="ttc" id="aclassturret__data_html"><div class="ttname"><a href="classturret__data.html">turret_data</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00473">vehicle.h:474</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a6753ecfe87da659675b18c2f81d6ec12"><div class="ttname"><a href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a></div><div class="ttdeci">constexpr double c</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01032">magic.cpp:1032</a></div></div>
<div class="ttc" id="anamespaceranged_html_a41e7f0a8b2c552d2f8ec4c8a4930c7af"><div class="ttname"><a href="namespaceranged.html#a41e7f0a8b2c552d2f8ec4c8a4930c7af">ranged::targetable_creatures</a></div><div class="ttdeci">std::vector&lt; Creature * &gt; targetable_creatures(const Character &amp;c, const int range, const turret_data &amp;turret)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02075">ranged.cpp:2075</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="magic_8cpp_source.html#l01032">c</a>, and <a class="el" href="ranged_8cpp_source.html#l02070">targetable_creatures()</a>.</p>

<p class="reference">Referenced by <a class="el" href="avatar__action_8cpp_source.html#l00587">avatar_action::autoattack()</a>, <a class="el" href="ranged_8cpp_source.html#l02070">targetable_creatures()</a>, and <a class="el" href="ranged_8cpp_source.html#l02671">target_ui::update_target_list()</a>.</p>

</div>
</div>
<a id="a41e7f0a8b2c552d2f8ec4c8a4930c7af" name="a41e7f0a8b2c552d2f8ec4c8a4930c7af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a41e7f0a8b2c552d2f8ec4c8a4930c7af">&#9670;&nbsp;</a></span>targetable_creatures() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; <a class="el" href="classCreature.html">Creature</a> * &gt; ranged::targetable_creatures </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>range</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classturret__data.html">turret_data</a> &amp;&#160;</td>
          <td class="paramname"><em>turret</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l02075">2075</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>{</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span>    <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *veh_from_turret = turret ? turret.<a class="code hl_function" href="classturret__data.html#aca7944937ce0285293b927c0c893d65a">get_veh</a>() : <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;get_creatures_if( [&amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, range, veh_from_turret]( <span class="keyword">const</span> <a class="code hl_class" href="classCreature.html">Creature</a> &amp; critter ) -&gt; <span class="keywordtype">bool</span> {</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>        <span class="keywordflow">if</span>( std::round( <a class="code hl_function" href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) ) &gt; range )</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span>        {</div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>            return false;</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>        }</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span> </div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>        <span class="keywordflow">if</span>( !<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.sees( critter ) &amp;&amp; !<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.sees_with_infrared( critter ) )</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>        {</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>            return false;</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>        }</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span> </div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>        <span class="comment">// TODO: get rid of fake npcs (pos() check)</span></div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>        <span class="keywordflow">if</span>( &amp;<a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a> == &amp;critter || <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos() == critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() || <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.attitude_to( critter ) == Creature::Attitude::A_FRIENDLY )</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>        {</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>            return false;</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>        }</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span> </div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span>        <a class="code hl_class" href="classmap.html">map</a> &amp;here = <a class="code hl_function" href="map_8cpp.html#acb0b34be6e497bdd2f9f40ae6929d562">get_map</a>();</div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span> </div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>        <span class="comment">// TODO: It should use projectile passability checks when finding path, not vision checks.</span></div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>        std::vector&lt;tripoint&gt; path = here.<a class="code hl_function" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), critter.<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() );</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>        <a class="code hl_struct" href="structtripoint.html">tripoint</a> prev_point = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos();</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code hl_struct" href="structtripoint.html">tripoint</a> &amp;<a class="code hl_struct" href="structpoint.html">point</a> : path )</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>        {</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>            if( here.obstructed_by_vehicle_rotation( prev_point, point ) ) {</div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>                <span class="comment">//Blocked by a rotated vehicle&#39;s walls</span></div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>                return false;</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>            }</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span> </div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>            prev_point = <a class="code hl_struct" href="structpoint.html">point</a>;</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span> </div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>            <span class="keywordflow">if</span>( here.passable( <a class="code hl_struct" href="structpoint.html">point</a> ) ) {</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>                <span class="comment">// If it&#39;s passable, it doesn&#39;t block bullets</span></div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>                continue;</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>            }</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span> </div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span>            <span class="keyword">const</span> <a class="code hl_class" href="classvehicle.html">vehicle</a> *veh_at_point = <a class="code hl_function" href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a>( here.veh_at( <a class="code hl_struct" href="structpoint.html">point</a> ) );</div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>            <span class="keywordflow">if</span>( veh_at_point &amp;&amp; veh_at_point != veh_from_turret ) {</div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>                <span class="comment">// Vehicles don&#39;t have impassable-but-shootable-through parts</span></div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>                return false;</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>            }</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>            <span class="keywordflow">if</span>( !here.has_flag_ter( <a class="code hl_enumvalue" href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f">TFLAG_TRANSPARENT</a>, <a class="code hl_struct" href="structpoint.html">point</a> ) ) {</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>                <span class="comment">// If it&#39;s transparent, it&#39;s either glass (fine) or reinforced glass (not fine)</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>                <span class="comment">// Hack it with the more common case for now</span></div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>                <span class="comment">// TODO: Handle armored glass</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>                return false;</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>            }</div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>        }</div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span> </div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span>    } );</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>}</div>
<div class="ttc" id="aclassmap_html_a0f73359be972a030063b4e84f770275e"><div class="ttname"><a href="classmap.html#a0f73359be972a030063b4e84f770275e">map::find_clear_path</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; find_clear_path(const tripoint &amp;source, const tripoint &amp;destination) const</div><div class="ttdoc">Iteratively tries Bresenham lines with different biases until it finds a clear line or decides there ...</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06257">map.cpp:6257</a></div></div>
<div class="ttc" id="aclassturret__data_html_aca7944937ce0285293b927c0c893d65a"><div class="ttname"><a href="classturret__data.html#aca7944937ce0285293b927c0c893d65a">turret_data::get_veh</a></div><div class="ttdeci">const vehicle * get_veh() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00495">vehicle.h:495</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00674">vehicle.h:675</a></div></div>
<div class="ttc" id="aline_8cpp_html_a2d906c9af0b0586f48bc34cff0838817"><div class="ttname"><a href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a></div><div class="ttdeci">float rl_dist_exact(const tripoint &amp;loc1, const tripoint &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00292">line.cpp:292</a></div></div>
<div class="ttc" id="amapdata_8h_html_aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f"><div class="ttname"><a href="mapdata_8h.html#aa04d037303ea30193f7cf0cd82304258ac945c31a7a3d56b4f17384b30f73133f">TFLAG_TRANSPARENT</a></div><div class="ttdeci">@ TFLAG_TRANSPARENT</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00276">mapdata.h:276</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00035">point.h:35</a></div></div>
<div class="ttc" id="avpart__position_8h_html_a67bd76da258293f1443f1356308381dc"><div class="ttname"><a href="vpart__position_8h.html#a67bd76da258293f1443f1356308381dc">veh_pointer_or_null</a></div><div class="ttdeci">vehicle * veh_pointer_or_null(const optional_vpart_position &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00154">vpart_position.h:154</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="map_8cpp_source.html#l06257">map::find_clear_path()</a>, <a class="el" href="game_8cpp_source.html#l00272">g</a>, <a class="el" href="map_8cpp_source.html#l00145">get_map()</a>, <a class="el" href="vehicle_8h_source.html#l00495">turret_data::get_veh()</a>, <a class="el" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos()</a>, <a class="el" href="line_8cpp_source.html#l00292">rl_dist_exact()</a>, <a class="el" href="mapdata_8h_source.html#l00276">TFLAG_TRANSPARENT</a>, and <a class="el" href="vpart__position_8h_source.html#l00154">veh_pointer_or_null()</a>.</p>

</div>
</div>
<a id="a581c5c797384eeec8c7e3ffe10a82d26" name="a581c5c797384eeec8c7e3ffe10a82d26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a581c5c797384eeec8c7e3ffe10a82d26">&#9670;&nbsp;</a></span>throw_cost()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::throw_cost </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classplayer.html">player</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>to_throw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
Throw increases throwing speed Dexterity increases throwing speed 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l00967">967</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>{</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>    <span class="comment">// Very similar to player::attack_cost</span></div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    <span class="comment">// TODO: Extract into a function?</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>    <span class="comment">// Differences:</span></div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    <span class="comment">// Dex is more (2x) important for throwing speed</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    <span class="comment">// At 10 skill, the cost is down to 0.75%, not 0.66%</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> base_move_cost = to_throw.<a class="code hl_function" href="classitem.html#ae75cd02ac10dda906018f27096a6efa9">attack_cost</a>() / 2;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_skill = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );<span class="comment"></span></div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span><span class="comment">    ///\EFFECT_THROW increases throwing speed</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> skill_cost = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( base_move_cost * ( 20 - throw_skill ) / 20 ) );<span class="comment"></span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span><span class="comment">    ///\EFFECT_DEX increases throwing speed</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dexbonus = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex();</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance_penalty = <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1">bp_torso</a> ) +</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>                                    ( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) ) / 2;</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina() ) / <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina_max();</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_penalty = 1.0 + std::max( ( 0.25f - stamina_ratio ) * 4.0f, 0.0f );</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span> </div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>    <span class="keywordtype">int</span> <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> = base_move_cost;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>    <span class="comment">// Stamina penalty only affects base/2 and encumbrance parts of the cost</span></div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += encumbrance_penalty;</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> *= stamina_penalty;</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> += skill_cost;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> -= dexbonus;</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> *= <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.mutation_value( <span class="stringliteral">&quot;attackcost_modifier&quot;</span> );</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span> </div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    <span class="keywordflow">return</span> std::max( 25, <a class="code hl_function" href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a> );</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>}</div>
<div class="ttc" id="aactivity__item__handling_8cpp_html_a0572000ec0976f2d095ae0cd9d20e78b"><div class="ttname"><a href="activity__item__handling_8cpp.html#a0572000ec0976f2d095ae0cd9d20e78b">move_cost</a></div><div class="ttdeci">static int move_cost(const item &amp;it, const tripoint &amp;src, const tripoint &amp;dest)</div><div class="ttdef"><b>Definition:</b> <a href="activity__item__handling_8cpp_source.html#l00899">activity_item_handling.cpp:899</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a></div><div class="ttdeci">@ bp_hand_l</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00046">bodypart.h:46</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a></div><div class="ttdeci">@ bp_hand_r</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00047">bodypart.h:47</a></div></div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980ab4b216482dcc0e468819f023c3aeddd1">bp_torso</a></div><div class="ttdeci">@ bp_torso</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00040">bodypart.h:40</a></div></div>
<div class="ttc" id="aclassitem_html_ae75cd02ac10dda906018f27096a6efa9"><div class="ttname"><a href="classitem.html#ae75cd02ac10dda906018f27096a6efa9">item::attack_cost</a></div><div class="ttdeci">int attack_cost() const</div><div class="ttdoc">Base number of moves (Creature::moves) that a single melee attack with this items takes.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05105">item.cpp:5105</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aca8ae2b9cbc86602a56a3885b72a4ed1"><div class="ttname"><a href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a></div><div class="ttdeci">static const skill_id skill_throw(&quot;throw&quot;)</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="item_8cpp_source.html#l05105">item::attack_cost()</a>, <a class="el" href="bodypart_8h_source.html#l00046">bp_hand_l</a>, <a class="el" href="bodypart_8h_source.html#l00047">bp_hand_r</a>, <a class="el" href="bodypart_8h_source.html#l00040">bp_torso</a>, <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="game__constants_8h_source.html#l00111">MAX_SKILL</a>, <a class="el" href="activity__item__handling_8cpp_source.html#l00899">move_cost()</a>, and <a class="el" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>.</p>

<p class="reference">Referenced by <a class="el" href="ranged_8cpp_source.html#l01588">draw_throw_aim()</a>, and <a class="el" href="ranged_8cpp_source.html#l01109">player::throw_item()</a>.</p>

</div>
</div>
<a id="afd6b1338d47e5ecd34de75b921c11113" name="afd6b1338d47e5ecd34de75b921c11113"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd6b1338d47e5ecd34de75b921c11113">&#9670;&nbsp;</a></span>throw_dispersion_per_dodge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::throw_dispersion_per_dodge </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>add_encumbrance</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How much dispersion does one point of target's dodge add when throwing at said target? </p>
Dexterity increases throwing accuracy against targets with good dodge stat 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01048">1048</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>{</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    <span class="comment">// +200 per dodge point at 0 dexterity</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    <span class="comment">// +100 at 8, +80 at 12, +66.6 at 16, +57 at 20, +50 at 24</span></div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <span class="comment">// Each 10 encumbrance on either hand is like -1 dex (can bring penalty to +400 per dodge)</span></div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    <span class="comment">// Maybe TODO: Only use one hand</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> encumbrance = add_encumbrance ? <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2806629e65a2c2eb5d8049e29e77910e">bp_hand_l</a> ) + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a54721306a0e05318b6d0440349c1a0fb">bp_hand_r</a> ) : 0;<span class="comment"></span></div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span><span class="comment">    ///\EFFECT_DEX increases throwing accuracy against targets with good dodge stat</span></div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="comment"></span>    <span class="keywordtype">float</span> effective_dex = 2 + <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex() / 4.0f - ( encumbrance ) / 40.0f;</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( 100.0f / std::max( 1.0f, effective_dex ) );</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00046">bp_hand_l</a>, <a class="el" href="bodypart_8h_source.html#l00047">bp_hand_r</a>, and <a class="el" href="magic_8cpp_source.html#l01032">c</a>.</p>

<p class="reference">Referenced by <a class="el" href="character__display_8cpp_source.html#l00370">draw_stats_info()</a>, <a class="el" href="newcharacter_8cpp_source.html#l00791">set_stats()</a>, and <a class="el" href="ranged_8cpp_source.html#l01062">throwing_dispersion()</a>.</p>

</div>
</div>
<a id="a54895869f69a00b4a74df15057a9a780" name="a54895869f69a00b4a74df15057a9a780"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54895869f69a00b4a74df15057a9a780">&#9670;&nbsp;</a></span>throwing_dispersion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ranged::throwing_dispersion </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classCharacter.html">Character</a> &amp;&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classitem.html">item</a> &amp;&#160;</td>
          <td class="paramname"><em>to_throw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCreature.html">Creature</a> *&#160;</td>
          <td class="paramname"><em>critter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_blind_throw</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dispersion of a thrown item, against a given target, taking into account whether or not the throw was blind. </p>
Strength decreases throwing dispersion when throwing heavy objects Throw increases throwing accuracy Perception decreases throwing accuracy penalty from eye encumbrance 
<p class="definition">Definition at line <a class="el" href="ranged_8cpp_source.html#l01062">1062</a> of file <a class="el" href="ranged_8cpp_source.html">ranged.cpp</a>.</p>
<div class="fragment"><div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>{</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code hl_function" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    <a class="code hl_class" href="classunits_1_1quantity.html">units::volume</a> <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> = to_throw.<a class="code hl_function" href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">volume</a>();</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordflow">if</span>( to_throw.<a class="code hl_function" href="classitem.html#a40963a016376016eb408bdb9dbb94388">count_by_charges</a>() &amp;&amp; to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> &gt; 1 ) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>        weight /= to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>        <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> /= to_throw.<a class="code hl_variable" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    }</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <span class="keywordtype">int</span> throw_difficulty = 1000;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="comment">// 1000 penalty for every liter after the first</span></div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <span class="comment">// TODO: Except javelin type items</span></div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>    throw_difficulty += std::max&lt;int&gt;( 0, <a class="code hl_function" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code hl_typedef" href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">volume</a> - 1_liter ) );</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    <span class="comment">// 1 penalty for gram above str*100 grams (at 0 skill)</span><span class="comment"></span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="comment">    ///\EFFECT_STR decreases throwing dispersion when throwing heavy objects</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> weight_in_gram = <a class="code hl_function" href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a>( weight );</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    throw_difficulty += std::max( 0, weight_in_gram - <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_str() * 100 );</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    <span class="comment">// Dispersion from difficult throws goes from 100% at lvl 0 to 20% at lvl 10</span><span class="comment"></span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">    ///\EFFECT_THROW increases throwing accuracy</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_skill = std::min( <a class="code hl_variable" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a>, <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code hl_variable" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>    <span class="keywordtype">int</span> dispersion = 10 * throw_difficulty / ( 6 * throw_skill + 20 );</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>    <span class="comment">// If the target is a creature, it moves around and ruins aim</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>    <span class="comment">// TODO: Inform projectile functions if the attacker actually aims for the critter or just the tile</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <span class="comment">// It&#39;s easier to dodge at close range (thrower needs to adjust more)</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <span class="comment">// Dodge x10 at point blank, x5 at 1 dist, then flat</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="keywordtype">float</span> effective_dodge = critter-&gt;<a class="code hl_function" href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">get_dodge</a>() * std::max( 1, 10 - 5 * <a class="code hl_function" href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(),</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>                                critter-&gt;<a class="code hl_function" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">pos</a>() ) );</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        dispersion += <a class="code hl_function" href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">throw_dispersion_per_dodge</a>( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">true</span> ) * effective_dodge;</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    }</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>    <span class="comment">// 1 perception per 1 eye encumbrance</span><span class="comment"></span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span><span class="comment">    ///\EFFECT_PER decreases throwing accuracy penalty from eye encumbrance</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span><span class="comment"></span>    dispersion += std::max( 0, ( <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.encumb( <a class="code hl_enumvalue" href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a> ) - <a class="code hl_variable" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_per() ) * 10 );</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span> </div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <span class="comment">// If throwing blind, we&#39;re assuming they mechanically can&#39;t achieve the</span></div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    <span class="comment">// accuracy of a normal throw.</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <span class="keywordflow">if</span>( is_blind_throw ) {</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>        dispersion *= 4;</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>    }</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span> </div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>    <span class="keywordflow">return</span> std::max( 0, dispersion );</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>}</div>
<div class="ttc" id="abodypart_8h_html_af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868"><div class="ttname"><a href="bodypart_8h.html#af618290c4c2de42aab87977ac7311980a2055386ee220ee2ca3e61d13df65e868">bp_eyes</a></div><div class="ttdeci">@ bp_eyes</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00042">bodypart.h:42</a></div></div>
<div class="ttc" id="aclassCreature_html_aaa501dbe3d1e90d47da43fb9ea57b3be"><div class="ttname"><a href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">Creature::get_dodge</a></div><div class="ttdeci">virtual float get_dodge() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01508">creature.cpp:1508</a></div></div>
<div class="ttc" id="aclassitem_html_a3157f01f1da6fe89bdbc87db2605afb9"><div class="ttname"><a href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">item::weight</a></div><div class="ttdeci">units::mass weight(bool include_contents=true, bool integral=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l04865">item.cpp:4865</a></div></div>
<div class="ttc" id="aclassitem_html_a40963a016376016eb408bdb9dbb94388"><div class="ttname"><a href="classitem.html#a40963a016376016eb408bdb9dbb94388">item::count_by_charges</a></div><div class="ttdeci">bool count_by_charges() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05876">item.cpp:5876</a></div></div>
<div class="ttc" id="aclassitem_html_a51eafbdf8b331d88b741c0c527f98eb9"><div class="ttname"><a href="classitem.html#a51eafbdf8b331d88b741c0c527f98eb9">item::volume</a></div><div class="ttdeci">units::volume volume(bool integral=false) const</div><div class="ttdoc">Total volume of an item accounting for all contained/integrated items NOTE: Result is rounded up to n...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l05012">item.cpp:5012</a></div></div>
<div class="ttc" id="aclassitem_html_a6bfb92ab5d41e0eb3a1da160fac71b0e"><div class="ttname"><a href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">item::charges</a></div><div class="ttdeci">int charges</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02195">item.h:2195</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html"><div class="ttname"><a href="classunits_1_1quantity.html">units::quantity</a></div><div class="ttdef"><b>Definition:</b> <a href="units__def_8h_source.html#l00014">units_def.h:15</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a47953b33a873caa0861b12222842a5ec"><div class="ttname"><a href="coordinates_8h.html#a47953b33a873caa0861b12222842a5ec">rl_dist</a></div><div class="ttdeci">int rl_dist(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00519">coordinates.h:519</a></div></div>
<div class="ttc" id="anamespaceranged_html_afd6b1338d47e5ecd34de75b921c11113"><div class="ttname"><a href="namespaceranged.html#afd6b1338d47e5ecd34de75b921c11113">ranged::throw_dispersion_per_dodge</a></div><div class="ttdeci">int throw_dispersion_per_dodge(const Character &amp;c, bool add_encumbrance)</div><div class="ttdoc">How much dispersion does one point of target's dodge add when throwing at said target?</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01048">ranged.cpp:1048</a></div></div>
<div class="ttc" id="anamespaceunits_html_a144476d36f26d6e1916493c3636d54dc"><div class="ttname"><a href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a></div><div class="ttdeci">constexpr value_type to_milliliter(const quantity&lt; value_type, volume_in_milliliter_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__volume_8h_source.html#l00038">units_volume.h:38</a></div></div>
<div class="ttc" id="anamespaceunits_html_a5d16607c866588620acb381e7dbbf0a6"><div class="ttname"><a href="namespaceunits.html#a5d16607c866588620acb381e7dbbf0a6">units::volume</a></div><div class="ttdeci">quantity&lt; int, volume_in_milliliter_tag &gt; volume</div><div class="ttdef"><b>Definition:</b> <a href="units__volume_8h_source.html#l00016">units_volume.h:16</a></div></div>
<div class="ttc" id="anamespaceunits_html_a8306911daadc1a4d7a7b46e9786f4a4c"><div class="ttname"><a href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a></div><div class="ttdeci">constexpr value_type to_gram(const quantity&lt; value_type, mass_in_milligram_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units__mass_8h_source.html#l00067">units_mass.h:67</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bodypart_8h_source.html#l00042">bp_eyes</a>, <a class="el" href="magic_8cpp_source.html#l01032">c</a>, <a class="el" href="item_8h_source.html#l02195">item::charges</a>, <a class="el" href="item_8cpp_source.html#l05876">item::count_by_charges()</a>, <a class="el" href="creature_8cpp_source.html#l01508">Creature::get_dodge()</a>, <a class="el" href="game__constants_8h_source.html#l00111">MAX_SKILL</a>, <a class="el" href="classCreature.html#a45926a7ba63ccc9be744f87a4d540b7d">Creature::pos()</a>, <a class="el" href="coordinates_8h_source.html#l00519">rl_dist()</a>, <a class="el" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>, <a class="el" href="ranged_8cpp_source.html#l01048">throw_dispersion_per_dodge()</a>, <a class="el" href="units__mass_8h_source.html#l00067">units::to_gram()</a>, <a class="el" href="units__volume_8h_source.html#l00038">units::to_milliliter()</a>, <a class="el" href="item_8cpp_source.html#l05012">item::volume()</a>, and <a class="el" href="item_8cpp_source.html#l04865">item::weight()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npcmove_8cpp_source.html#l02071">npc::confident_throw_range()</a>, <a class="el" href="ranged_8cpp_source.html#l01588">draw_throw_aim()</a>, and <a class="el" href="ranged_8cpp_source.html#l01109">player::throw_item()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceranged.html">ranged</a></li>
    <li class="footer">Generated on Wed Oct 19 2022 14:19:58 for Cataclysm BN by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
